<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd"><html><head><meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1"/><link rel="stylesheet" href="lpdoc.css" type="text/css"/><title>SQL persistent database interface &mdash; The Ciao System v1.14#2</title></head><body><div class="nav"><span class="on_right"><a class="navbutton" href="factsdb_rt.html">&#x25C4;</a><a class="navbutton" href="pl2sql.html">&#x25BA;</a></span><span><a href="ciao.html">The Ciao System</a> &raquo; <a href="Interfaces.html">PART VIII - Interfaces to other languages and systems</a> &raquo; </span></div><div class="documentwrapper"><div class="document"><div class="mainwrapper"><div class="main"><div id=""><h1>SQL persistent database interface</h1><a class="idx_anchor" href="ciaoliindex.html#persdbrt_mysql"></a>
<strong>Author(s):</strong> <a class="idx_anchor" id="Ignacio Caballero" href="ciaoauindex.html#Ignacio Caballero">Ignacio Caballero</a>, <a class="idx_anchor" id="Daniel Cabeza" href="ciaoauindex.html#Daniel Cabeza">Daniel Cabeza</a>, <a class="idx_anchor" id="Jose Manuel Gomez Perez" href="ciaoauindex.html#Jose Manuel Gomez Perez">Jos&eacute; Manuel G&oacute;mez P&eacute;rez</a>, <a class="idx_anchor" id="Manuel Hermenegildo" href="ciaoauindex.html#Manuel Hermenegildo">Manuel Hermenegildo</a>, <a class="idx_anchor" id="Jose F. Morales" href="ciaoauindex.html#Jose F. Morales">Jose F. Morales</a>, <a class="idx_anchor" id="Manuel Carro" href="ciaoauindex.html#Manuel Carro">Manuel Carro</a>, <a class="idx_anchor" id="The CLIP Group" href="ciaoauindex.html#The CLIP Group">The CLIP Group</a>.<p>
The purpose of this library is to implement an instance of the generic concept of <a class="idx_anchor" id="0" href="ciaoglindex.html#persistent predicates">persistent predicates</a>, where external <a class="idx_anchor" id="1" href="ciaoglindex.html#relational databases">relational databases</a> are used for storage (see the documentation of the <a class="idx_anchor" id="2" href="ciaoglindex.html#persdb"><tt>persdb</tt></a> library and [<a href="ciaorefs.html#radioweb-D3.1.M1-A1">CHGT98</a>,<a href="ciaorefs.html#radioweb-ta">Par97</a>] for details). To this end, this library exports SQL persistent versions of the <a class="idx_anchor" id="3" href="ciaoglindex.html#assertz_fact/1"><tt>assertz_fact/1</tt></a>, <a class="idx_anchor" id="4" href="ciaoglindex.html#retract_fact/1"><tt>retract_fact/1</tt></a> and <a class="idx_anchor" id="5" href="ciaoglindex.html#retractall_fact/1"><tt>retractall_fact/1</tt></a> builtin predicates. Persistent predicates also allow <a class="idx_anchor" id="6" href="ciaoglindex.html#concurrent updates">concurrent updates</a> from several programs, since each update is atomic.<p>The notion of persistence provides a very natural and transparent way to access database relations from a Prolog program. Stub definitions are provided for such predicates which access the database when the predicate is called (using the <a class="idx_anchor" id="7" href="ciaoglindex.html#db_client"><tt>db_client</tt></a> library). A <a class="idx_anchor" id="8" href="ciaoglindex.html#Prolog to SQL translator">Prolog to SQL translator</a> is used to generate the required <a class="idx_anchor" id="9" href="ciaoglindex.html#SQL">SQL</a> code dynamically (see library <a class="idx_anchor" id="10" href="ciaoglindex.html#pl2sql"><tt>pl2sql</tt></a>).<p>This library also provides facilities for reflecting more complex <a class="idx_anchor" id="11" href="ciaoglindex.html#views">views</a> of the database relations as Prolog predicates. Such views can be constructed as conjunctions, disjunctions, projections, etc. of database relations. Also, <a class="idx_anchor" id="12" href="ciaoglindex.html#SQL">SQL</a>-like <a class="idx_anchor" id="13" href="ciaoglindex.html#aggregation operations">aggregation operations</a> are supported.<p><div id="Implementation of the Database Interface"><h2>Implementation of the Database Interface</h2> <p>The architecture of the low-level implementation of the database interface was defined with two goals in mind:<p><ul> <LI>to simplify the communication between the Prolog system and the relational database engines as much as possible, and<p><LI>to give as much flexibility as possible to the overall system. This includes simultaneous access to several databases, allowing both the databases and clients to reside on the same physical machine or different machines, and allowing the clients to reside in Win95/NT or Unix machines. </ul> <p> In order to allow the flexibility mentioned above, a client-sever architecture was chosen. At the server side, a MySQL server connects to the databases using the MySQL. At the client side, a MySQL client interface connects to this server. The server daemon (mysqld) should be running in the server machine; check your MySQL documentation on how to do that.<p>After the connection is established a client can send commands to the mediator server which will pass them to the corresponding database server, and then the data will traverse in the opposite direction. These messages include logging on and off from the database, sending SQL queries, and receiving the responses.<p>The low level implementation of the current library is accomplished by providing abstraction levels over the MySQL interface library. These layers of abstraction implement the persistent predicate view, build the appropriate commands for the database using a translator of Prolog goals to SQL commands, issue such commands using the mediator send/receive procedures, parse the responses, and present such responses to the Prolog engine via backtracking.<p></div><div id="Example(s)"><h2>Example(s)</h2> <p><pre>
</pre> </div><br/><div id="Usage and interface"><h2>Usage and interface</h2><div class="cartouche"><ul><LI><strong>Library usage:</strong><br/>Typically, this library is used including the &apos;persdb_mysql&apos; package into the package list of the module, or using the <a class="idx_anchor" id="14" href="ciaoglindex.html#use_package/1"><tt>use_package/1</tt></a> declaration: <dl> <DT>In a module:<dd> <pre>	:- module(bar, [main/1], [persdb_mysql]).
</pre> or <pre>        :- module(bar, [main/1]).
        :- include(library(persdb_mysql)).
</pre> <DT>In a <em>user</em> file:<dd> <pre>	:- use_package([persdb_mysql]).
</pre> or <pre>        :- include(library(persdb_mysql)).
</pre> </dl> This loads the run-time and compile-time versions of the library (<tt>persdbtr_mysql.pl</tt> and <tt>persdbrt_mysql.pl</tt>) and includes some needed declarations.<LI><strong>Exports:</strong><br/><ul class="itemize_minus"><LI><em>Predicates:</em><br/><a class="idx_anchor" id="15" href="ciaoglindex.html#init_sql_persdb/0"><tt>init_sql_persdb/0</tt></a>, <a class="idx_anchor" id="16" href="ciaoglindex.html#dbassertz_fact/1"><tt>dbassertz_fact/1</tt></a>, <a class="idx_anchor" id="17" href="ciaoglindex.html#dbretract_fact/1"><tt>dbretract_fact/1</tt></a>, <a class="idx_anchor" id="18" href="ciaoglindex.html#dbcurrent_fact/1"><tt>dbcurrent_fact/1</tt></a>, <a class="idx_anchor" id="19" href="ciaoglindex.html#dbretractall_fact/1"><tt>dbretractall_fact/1</tt></a>, <a class="idx_anchor" id="20" href="ciaoglindex.html#make_sql_persistent/3"><tt>make_sql_persistent/3</tt></a>, <a class="idx_anchor" id="21" href="ciaoglindex.html#dbfindall/4"><tt>dbfindall/4</tt></a>, <a class="idx_anchor" id="22" href="ciaoglindex.html#dbcall/2"><tt>dbcall/2</tt></a>, <a class="idx_anchor" id="23" href="ciaoglindex.html#sql_query/3"><tt>sql_query/3</tt></a>, <a class="idx_anchor" id="24" href="ciaoglindex.html#sql_get_tables/2"><tt>sql_get_tables/2</tt></a>, <a class="idx_anchor" id="25" href="ciaoglindex.html#sql_table_types/3"><tt>sql_table_types/3</tt></a>.
<LI><em>Multifiles:</em><br/><a class="idx_anchor" id="26" href="ciaoglindex.html#sql_persistent_location/2"><tt>sql_persistent_location/2</tt></a>.
</ul><LI><strong>Other modules used:</strong><br/><ul class="itemize_minus"><LI><em>System library modules:</em><br/><a class="idx_anchor" id="27" href="ciaoglindex.html#det_hook/det_hook_rt"><tt>det_hook/det_hook_rt</tt></a>, <a class="idx_anchor" id="28" href="ciaoglindex.html#persdb_mysql/db_client_types"><tt>persdb_mysql/db_client_types</tt></a>, <a class="idx_anchor" id="29" href="ciaoglindex.html#persdb_mysql/pl2sql"><tt>persdb_mysql/pl2sql</tt></a>, <a class="idx_anchor" id="30" href="ciaoglindex.html#persdb_sql_common/sqltypes"><tt>persdb_sql_common/sqltypes</tt></a>, <a class="idx_anchor" id="31" href="ciaoglindex.html#dynamic"><tt>dynamic</tt></a>, <a class="idx_anchor" id="32" href="ciaoglindex.html#terms"><tt>terms</tt></a>, <a class="idx_anchor" id="33" href="ciaoglindex.html#terms_vars"><tt>terms_vars</tt></a>, <a class="idx_anchor" id="34" href="ciaoglindex.html#messages"><tt>messages</tt></a>, <a class="idx_anchor" id="35" href="ciaoglindex.html#lists"><tt>lists</tt></a>, <a class="idx_anchor" id="36" href="ciaoglindex.html#aggregates"><tt>aggregates</tt></a>, <a class="idx_anchor" id="37" href="ciaoglindex.html#persdb_mysql/mysql_client"><tt>persdb_mysql/mysql_client</tt></a>, <a class="idx_anchor" id="38" href="ciaoglindex.html#persdb_sql_common/pl2sqlinsert"><tt>persdb_sql_common/pl2sqlinsert</tt></a>, <a class="idx_anchor" id="39" href="ciaoglindex.html#persdb_mysql/delete_compiler/pl2sqldelete"><tt>persdb_mysql/delete_compiler/pl2sqldelete</tt></a>.
</ul></ul></div></div><div id="Documentation on exports"><h2>Documentation on exports</h2><div><span class="on_right">PREDICATE</span><div class="defname"><a class="idx_anchor" id="init_sql_persdb/0" href="ciaopdindex.html#init_sql_persdb/0">init_sql_persdb/0</a>:</div><div class="deftext"><p><strong>Usage:</strong> <ul class="itemize_minus"><LI><em>Description:</em> Internal predicate, used to transform predicates statically declared as persistent (see <a class="idx_anchor" id="40" href="ciaoglindex.html#sql_persistent/3"><tt>sql_persistent/3</tt></a>) into real persistent predicates. </ul></div></div><p>
<div><span class="on_right">PREDICATE</span><div class="defname"><a class="idx_anchor" id="dbassertz_fact/1" href="ciaopdindex.html#dbassertz_fact/1">dbassertz_fact/1</a>:</div><div class="deftext"><p><strong>Usage:</strong> <tt>dbassertz_fact(Fact)</tt>
<ul class="itemize_minus"><LI><em>Description:</em> Persistent extension of <a class="idx_anchor" id="41" href="ciaoglindex.html#assertz_fact/1"><tt>assertz_fact/1</tt></a>: the current instance of <span class="var">Fact</span> is interpreted as a fact (i.e., a relation tuple) and is added to the end of the definition of the corresponding predicate. If any integrity constraint violation is done (database stored predicates), an error will be displayed. The predicate concerned must be statically (<a class="idx_anchor" id="42" href="ciaoglindex.html#sql_persistent/3"><tt>sql_persistent/3</tt></a>) or dinamically (<a class="idx_anchor" id="43" href="ciaoglindex.html#make_sql_persistent/3"><tt>make_sql_persistent/3</tt></a>) declared. Any uninstantiated variables in the <span class="var">Fact</span> will be replaced by new, private variables. <strong>Note</strong>: <em>assertion of facts with uninstantiated variables not implemented at this time.</em><LI><em>Call and exit should be compatible with:</em><br/><span class="on_right"> (persdbrt_mysql:fact/1)</span><span><span class="var">Fact</span> is a fact (a term whose main functor is not <tt>&apos;:-&apos;/2</tt>).
</span>
<LI><em>The following properties should hold at call time:</em><br/><span class="on_right"> (term_typing:nonvar/1)</span><span><span class="var">Fact</span> is currently a term which is not a free variable.
</span>
</ul></div></div><p>
<div><span class="on_right">PREDICATE</span><div class="defname"><a class="idx_anchor" id="dbretract_fact/1" href="ciaopdindex.html#dbretract_fact/1">dbretract_fact/1</a>:</div><div class="deftext"><p><strong>Usage:</strong> <tt>dbretract_fact(Fact)</tt>
<ul class="itemize_minus"><LI><em>Description:</em> Persistent extension of <a class="idx_anchor" id="44" href="ciaoglindex.html#retract_fact/1"><tt>retract_fact/1</tt></a>: deletes on backtracking all the facts which unify with <span class="var">Fact</span>. The predicate concerned must be statically (<a class="idx_anchor" id="45" href="ciaoglindex.html#sql_persistent/3"><tt>sql_persistent/3</tt></a>) or dinamically (<a class="idx_anchor" id="46" href="ciaoglindex.html#make_sql_persistent/3"><tt>make_sql_persistent/3</tt></a>) declared.<LI><em>Call and exit should be compatible with:</em><br/><span class="on_right"> (persdbrt_mysql:fact/1)</span><span><span class="var">Fact</span> is a fact (a term whose main functor is not <tt>&apos;:-&apos;/2</tt>).
</span>
<LI><em>The following properties should hold at call time:</em><br/><span class="on_right"> (term_typing:nonvar/1)</span><span><span class="var">Fact</span> is currently a term which is not a free variable.
</span>
</ul></div></div><p>
<div><span class="on_right">PREDICATE</span><div class="defname"><a class="idx_anchor" id="dbcurrent_fact/1" href="ciaopdindex.html#dbcurrent_fact/1">dbcurrent_fact/1</a>:</div><div class="deftext"><p><strong>Usage:</strong> <tt>dbcurrent_fact(Fact)</tt>
<ul class="itemize_minus"><LI><em>Description:</em> Persistent extension of <a class="idx_anchor" id="47" href="ciaoglindex.html#current_fact/1"><tt>current_fact/1</tt></a>: the fact <span class="var">Fact</span> exists in the current database. The predicate concerned must be declared <a class="idx_anchor" id="48" href="ciaoglindex.html#sql_persistent/3"><tt>sql_persistent/3</tt></a>. Provides on backtracking all the facts (tuples) which unify with <span class="var">Fact</span>.<LI><em>Call and exit should be compatible with:</em><br/><span class="on_right"> (persdbrt_mysql:fact/1)</span><span><span class="var">Fact</span> is a fact (a term whose main functor is not <tt>&apos;:-&apos;/2</tt>).
</span>
<LI><em>The following properties should hold at call time:</em><br/><span class="on_right"> (term_typing:nonvar/1)</span><span><span class="var">Fact</span> is currently a term which is not a free variable.
</span>
</ul></div></div><p>
<div><span class="on_right">PREDICATE</span><div class="defname"><a class="idx_anchor" id="dbretractall_fact/1" href="ciaopdindex.html#dbretractall_fact/1">dbretractall_fact/1</a>:</div><div class="deftext"><p><strong>Usage:</strong> <tt>dbretractall_fact(Fact)</tt>
<ul class="itemize_minus"><LI><em>Description:</em> Persistent extension of <a class="idx_anchor" id="49" href="ciaoglindex.html#retractall_fact/1"><tt>retractall_fact/1</tt></a>: when called deletes all the facts which unify with <span class="var">Fact</span>. The predicate concerned must be statically (<a class="idx_anchor" id="50" href="ciaoglindex.html#sql_persistent/3"><tt>sql_persistent/3</tt></a>) or dinamically (<a class="idx_anchor" id="51" href="ciaoglindex.html#make_sql_persistent/3"><tt>make_sql_persistent/3</tt></a>) declared.<LI><em>Call and exit should be compatible with:</em><br/><span class="on_right"> (persdbrt_mysql:fact/1)</span><span><span class="var">Fact</span> is a fact (a term whose main functor is not <tt>&apos;:-&apos;/2</tt>).
</span>
<LI><em>The following properties should hold at call time:</em><br/><span class="on_right"> (term_typing:nonvar/1)</span><span><span class="var">Fact</span> is currently a term which is not a free variable.
</span>
</ul></div></div><p>
<div><span class="on_right">PREDICATE</span><div class="defname"><a class="idx_anchor" id="make_sql_persistent/3" href="ciaopdindex.html#make_sql_persistent/3">make_sql_persistent/3</a>:</div><div class="deftext"><br/>
<em>Meta-predicate</em> with arguments: <tt>make_sql_persistent(addmodule(?),?,?)</tt>.<br/><p><strong>Usage:</strong> <tt>make_sql_persistent(PrologPredTypes,TableAttributes,Keyword)</tt>
<ul class="itemize_minus"><LI><em>Description:</em> Dynamic version of the <a class="idx_anchor" id="52" href="ciaoglindex.html#sql_persistent/3"><tt>sql_persistent/3</tt></a> declaration.<LI><em>The following properties should hold upon exit:</em><br/><span class="on_right"> (persdbrt_mysql:prologPredTypes/1)</span><span><span class="var">PrologPredTypes</span> is a structure describing a Prolog predicate name with its types.
</span><br/><span class="on_right"> (persdbrt_mysql:tableAttributes/1)</span><span><span class="var">TableAttributes</span> is a structure describing a table name and some attributes.
</span><br/><span class="on_right"> (persdbrt_mysql:persLocId/1)</span><span><span class="var">Keyword</span> is the name of a persistent storage location.
</span>
</ul></div></div><p>
<div><span class="on_right">PREDICATE</span><div class="defname"><a class="idx_anchor" id="dbfindall/4" href="ciaopdindex.html#dbfindall/4">dbfindall/4</a>:</div><div class="deftext"><br/>
<em>Meta-predicate</em> with arguments: <tt>dbfindall(?,?,goal,?)</tt>.<br/><p><strong>Usage:</strong> <tt>dbfindall(DBId,Pattern,ComplexGoal,Results)</tt>
<ul class="itemize_minus"><LI><em>Description:</em> Similar to <a class="idx_anchor" id="53" href="ciaoglindex.html#findall/3"><tt>findall/3</tt></a>, but <span class="var">Goal</span> is executed in database <span class="var">DBId</span>. Certain restrictions and extensions apply to both <span class="var">Pattern</span> and <span class="var">ComplexGoal</span> stemming from the Prolog to SQL translation involved (see the corresponding type definitions for details).<LI><em>Call and exit should be compatible with:</em><br/><span class="on_right"> (mysql_client:dbconnection/1)</span><span><span class="var">DBId</span> a unique identifier of a database session connection.
</span><br/><span class="on_right"> (pl2sql:projterm/1)</span><span><span class="var">Pattern</span> is a database projection term.
</span><br/><span class="on_right"> (pl2sql:querybody/1)</span><span><span class="var">ComplexGoal</span> is a database query goal.
</span><br/><span class="on_right"> (basic_props:list/1)</span><span><span class="var">Results</span> is a list.
</span>
<LI><em>The following properties should hold at call time:</em><br/><span class="on_right"> (term_typing:nonvar/1)</span><span><span class="var">DBId</span> is currently a term which is not a free variable.
</span><br/><span class="on_right"> (term_typing:nonvar/1)</span><span><span class="var">Pattern</span> is currently a term which is not a free variable.
</span><br/><span class="on_right"> (term_typing:nonvar/1)</span><span><span class="var">ComplexGoal</span> is currently a term which is not a free variable.
</span><br/><span class="on_right"> (term_typing:var/1)</span><span><span class="var">Results</span> is a free variable.
</span>
</ul></div></div><p>
<div><span class="on_right">PREDICATE</span><div class="defname"><a class="idx_anchor" id="dbcall/2" href="ciaopdindex.html#dbcall/2">dbcall/2</a>:</div><div class="deftext"><p><strong>Usage:</strong> <tt>dbcall(DBId,ComplexGoal)</tt>
<ul class="itemize_minus"><LI><em>Description:</em> Internal predicate, used by the transformed versions of the persistent predicates. Not meant to be called directly by users. It is exported by the library so that it can be used by the transformed versions of the persistent predicates in the modules in which they reside. Sends <span class="var">ComplexGoal</span> to database <span class="var">DBId</span> for evaluation. <span class="var">ComplexGoal</span> must be a call to a persistent predicate which resides in database <span class="var">DBId</span>.<LI><em>Call and exit should be compatible with:</em><br/><span class="on_right"> (mysql_client:dbconnection/1)</span><span><span class="var">DBId</span> a unique identifier of a database session connection.
</span><br/><span class="on_right"> (pl2sql:querybody/1)</span><span><span class="var">ComplexGoal</span> is a database query goal.
</span>
<LI><em>The following properties should hold at call time:</em><br/><span class="on_right"> (term_typing:nonvar/1)</span><span><span class="var">DBId</span> is currently a term which is not a free variable.
</span><br/><span class="on_right"> (term_typing:nonvar/1)</span><span><span class="var">ComplexGoal</span> is currently a term which is not a free variable.
</span>
</ul></div></div><p>
<div><span class="on_right">PREDICATE</span><div class="defname"><a class="idx_anchor" id="sql_query/3" href="ciaopdindex.html#sql_query/3">sql_query/3</a>:</div><div class="deftext"><p><strong>Usage:</strong> <tt>sql_query(DBId,SQLString,AnswerTableTerm)</tt>
<ul class="itemize_minus"><LI><em>Description:</em> <span class="var">ResultTerm</span> is the response from database <span class="var">DBId</span> to the <a class="idx_anchor" id="54" href="ciaoglindex.html#SQL query">SQL query</a> in <span class="var">SQLString</span> to database <span class="var">DBId</span>. <span class="var">AnswerTableTerm</span> can express a set of tuples, an error answer or a &apos;ok&apos; response (see <a class="idx_anchor" id="55" href="ciaoglindex.html#answertableterm/1"><tt>answertableterm/1</tt></a> for details). At the moment, <a class="idx_anchor" id="56" href="ciaoglindex.html#sql_query/3"><tt>sql_query/3</tt></a> log in and out for each query. This should be changed to log in only the first time and log out on exit and/or via a timer in the standard way.<LI><em>Call and exit should be compatible with:</em><br/><span class="on_right"> (mysql_client:dbconnection/1)</span><span><span class="var">DBId</span> a unique identifier of a database session connection.
</span><br/><span class="on_right"> (pl2sql:sqlstring/1)</span><span><span class="var">SQLString</span> is a string containing SQL code.
</span><br/><span class="on_right"> (persdbrt_mysql:answertableterm/1)</span><span><span class="var">AnswerTableTerm</span> is a response from the ODBC database interface.
</span>
<LI><em>The following properties should hold at call time:</em><br/><span class="on_right"> (term_typing:nonvar/1)</span><span><span class="var">DBId</span> is currently a term which is not a free variable.
</span><br/><span class="on_right"> (term_typing:nonvar/1)</span><span><span class="var">SQLString</span> is currently a term which is not a free variable.
</span>
</ul></div></div><p>
<div><span class="on_right">PREDICATE</span><div class="defname"><a class="idx_anchor" id="sql_get_tables/2" href="ciaopdindex.html#sql_get_tables/2">sql_get_tables/2</a>:</div><div class="deftext"><p><strong>Usage 1:</strong> <tt>sql_get_tables(Location,Tables)</tt>
<ul class="itemize_minus"><LI><em>Description:</em> <span class="var">Tables</span> contains the tables available in <span class="var">Location</span>.<LI><em>Call and exit should be compatible with:</em><br/><span class="on_right"> (persdbrt_mysql:database_desc/1)</span><span><span class="var">Location</span> is a structure describing a database.
</span><br/><span class="on_right"> (basic_props:list/2)</span><span><span class="var">Tables</span> is a list of <span class="var">atm</span>s.
</span>
<LI><em>The following properties should hold at call time:</em><br/><span class="on_right"> (term_typing:nonvar/1)</span><span><span class="var">Location</span> is currently a term which is not a free variable.
</span><br/><span class="on_right"> (term_typing:var/1)</span><span><span class="var">Tables</span> is a free variable.
</span>
</ul><p><strong>Usage 2:</strong> <tt>sql_get_tables(DbConnection,Tables)</tt>
<ul class="itemize_minus"><LI><em>Description:</em> <span class="var">Tables</span> contains the tables available in <span class="var">DbConnection</span>.<LI><em>Call and exit should be compatible with:</em><br/><span class="on_right"> (mysql_client:dbconnection/1)</span><span><span class="var">DbConnection</span> a unique identifier of a database session connection.
</span><br/><span class="on_right"> (basic_props:list/2)</span><span><span class="var">Tables</span> is a list of <span class="var">atm</span>s.
</span>
<LI><em>The following properties should hold at call time:</em><br/><span class="on_right"> (term_typing:nonvar/1)</span><span><span class="var">DbConnection</span> is currently a term which is not a free variable.
</span><br/><span class="on_right"> (term_typing:var/1)</span><span><span class="var">Tables</span> is a free variable.
</span>
</ul></div></div><p>
<div><span class="on_right">PREDICATE</span><div class="defname"><a class="idx_anchor" id="sql_table_types/3" href="ciaopdindex.html#sql_table_types/3">sql_table_types/3</a>:</div><div class="deftext"><p><strong>Usage 1:</strong> <tt>sql_table_types(Location,Table,AttrTypes)</tt>
<ul class="itemize_minus"><LI><em>Description:</em> <span class="var">AttrTypes</span> are the attributes and types of <span class="var">Table</span> in <span class="var">Location</span>.<LI><em>Call and exit should be compatible with:</em><br/><span class="on_right"> (persdbrt_mysql:database_desc/1)</span><span><span class="var">Location</span> is a structure describing a database.
</span><br/><span class="on_right"> (basic_props:atm/1)</span><span><span class="var">Table</span> is an atom.
</span><br/><span class="on_right"> (basic_props:list/1)</span><span><span class="var">AttrTypes</span> is a list.
</span>
<LI><em>The following properties should hold at call time:</em><br/><span class="on_right"> (term_typing:nonvar/1)</span><span><span class="var">Location</span> is currently a term which is not a free variable.
</span><br/><span class="on_right"> (term_typing:nonvar/1)</span><span><span class="var">Table</span> is currently a term which is not a free variable.
</span><br/><span class="on_right"> (term_typing:var/1)</span><span><span class="var">AttrTypes</span> is a free variable.
</span>
</ul><p><strong>Usage 2:</strong> <tt>sql_table_types(DbConnection,Table,AttrTypes)</tt>
<ul class="itemize_minus"><LI><em>Description:</em> <span class="var">AttrTypes</span> are the attributes and types of <span class="var">Table</span> in <span class="var">DbConnection</span>.<LI><em>Call and exit should be compatible with:</em><br/><span class="on_right"> (mysql_client:dbconnection/1)</span><span><span class="var">DbConnection</span> a unique identifier of a database session connection.
</span><br/><span class="on_right"> (basic_props:atm/1)</span><span><span class="var">Table</span> is an atom.
</span><br/><span class="on_right"> (basic_props:list/1)</span><span><span class="var">AttrTypes</span> is a list.
</span>
<LI><em>The following properties should hold at call time:</em><br/><span class="on_right"> (term_typing:nonvar/1)</span><span><span class="var">DbConnection</span> is currently a term which is not a free variable.
</span><br/><span class="on_right"> (term_typing:nonvar/1)</span><span><span class="var">Table</span> is currently a term which is not a free variable.
</span><br/><span class="on_right"> (term_typing:var/1)</span><span><span class="var">AttrTypes</span> is a free variable.
</span>
</ul></div></div><p>
<div><span class="on_right">REGTYPE</span><div class="defname"><a class="idx_anchor" id="socketname/1" href="ciaoteindex.html#socketname/1">socketname/1</a>:</div><div class="deftext"><p><strong>Usage:</strong> <tt>socketname(IPP)</tt>
<ul class="itemize_minus"><LI><em>Description:</em> <span class="var">IPP</span> is a structure describing a complete TCP/IP port address.</ul></div></div><p>
<div><span class="on_right">REGTYPE</span><div class="defname"><a class="idx_anchor" id="dbname/1" href="ciaoteindex.html#dbname/1">dbname/1</a>:</div><div class="deftext"><p><strong>Usage:</strong> <tt>dbname(DBId)</tt>
<ul class="itemize_minus"><LI><em>Description:</em> <span class="var">DBId</span> is the identifier of an database.</ul></div></div><p>
<div><span class="on_right">REGTYPE</span><div class="defname"><a class="idx_anchor" id="user/1" href="ciaoteindex.html#user/1">user/1</a>:</div><div class="deftext"><p><strong>Usage:</strong> <tt>user(User)</tt>
<ul class="itemize_minus"><LI><em>Description:</em> <span class="var">User</span> is a user name in the database.</ul></div></div><p>
<div><span class="on_right">REGTYPE</span><div class="defname"><a class="idx_anchor" id="passwd/1" href="ciaoteindex.html#passwd/1">passwd/1</a>:</div><div class="deftext"><p><strong>Usage:</strong> <tt>passwd(Passwd)</tt>
<ul class="itemize_minus"><LI><em>Description:</em> <span class="var">Passwd</span> is the password for the user name in the database.</ul></div></div><p>
<div><span class="on_right">REGTYPE</span><div class="defname"><a class="idx_anchor" id="projterm/1" href="ciaoteindex.html#projterm/1">projterm/1</a>:</div><div class="deftext"><p><strong>Usage:</strong> <tt>projterm(DBProjTerm)</tt>
<ul class="itemize_minus"><LI><em>Description:</em> <span class="var">DBProjTerm</span> is a database projection term.</ul></div></div><p>
<div><span class="on_right">REGTYPE</span><div class="defname"><a class="idx_anchor" id="querybody/1" href="ciaoteindex.html#querybody/1">querybody/1</a>:</div><div class="deftext"><p><strong>Usage:</strong> <tt>querybody(DBGoal)</tt>
<ul class="itemize_minus"><LI><em>Description:</em> <span class="var">DBGoal</span> is a database query goal.</ul></div></div><p>
<div><span class="on_right">(UNDOC_REEXPORT)</span><div class="defname"><span class="idx_anchor" id="sqltype/1">sqltype/1</span>:</div><div class="deftext">
 Imported from <a class="idx_anchor" id="57" href="ciaoglindex.html#sqltypes"><tt>sqltypes</tt></a> (see the corresponding documentation for details).<br/></div></div><p>
</div><div id="Documentation on multifiles"><h2>Documentation on multifiles</h2><div><span class="on_right">PREDICATE</span><div class="defname"><a class="idx_anchor" id="sql_persistent_location/2" href="ciaopdindex.html#sql_persistent_location/2">sql_persistent_location/2</a>:</div><div class="deftext">Relates names of locations (the <span class="var">Keyword</span>s) with descriptions of such locations (<span class="var">Location</span>s).<br/>
The predicate is <em>multifile</em>.<br/>
The predicate is of type <em>data</em>.<br/><p><strong>Usage:</strong> <tt>sql_persistent_location(Keyword,DBLocation)</tt>
<ul class="itemize_minus"><LI><em>Description:</em> In this usage, <span class="var">DBLocation</span> is a <em>relational database</em>, in which case the predicate is stored as tuples in the database.<LI><em>The following properties should hold upon exit:</em><br/><span class="on_right"> (persdbrt_mysql:persLocId/1)</span><span><span class="var">Keyword</span> is the name of a persistent storage location.
</span><br/><span class="on_right"> (persdbrt_mysql:database_desc/1)</span><span><span class="var">DBLocation</span> is a structure describing a database.
</span>
</ul></div></div><p>
</div><div id="Documentation on internals"><h2>Documentation on internals</h2><div><span class="on_right">REGTYPE</span><div class="defname"><a class="idx_anchor" id="tuple/1" href="ciaoteindex.html#tuple/1">tuple/1</a>:</div><div class="deftext"><pre>tuple(T) :-
        list(T,atm).
tuple(T) :-
        list(T,atm).
</pre><p><strong>Usage:</strong> <tt>tuple(T)</tt>
<ul class="itemize_minus"><LI><em>Description:</em> <span class="var">T</span> is a tuple of values from the ODBC database interface.</ul></div></div><p>
<div><span class="on_right">REGTYPE</span><div class="defname"><a class="idx_anchor" id="dbconnection/1" href="ciaoteindex.html#dbconnection/1">dbconnection/1</a>:</div><div class="deftext"><p><strong>Usage:</strong> <tt>dbconnection(H)</tt>
<ul class="itemize_minus"><LI><em>Description:</em> <span class="var">H</span> a unique identifier of a database session connection.</ul></div></div><p>
<div><span class="on_right">DECLARATION</span><div class="defname"><a class="idx_anchor" id="sql_persistent/3" href="ciaodeindex.html#sql_persistent/3">sql_persistent/3</a>:</div><div class="deftext"><p><strong>Usage:</strong> :- <tt>sql_persistent(PrologPredTypes,TableAttributes,Keyword)</tt>.
<ul class="itemize_minus"><LI><em>Description:</em> Declares the predicate corresponding to the main functor of <span class="var">PrologPredTypes</span> as SQL persistent. <span class="var">Keyword</span> is the <a class="idx_anchor" id="58" href="ciaoglindex.html#name of a location">name of a location</a> where the <a class="idx_anchor" id="59" href="ciaoglindex.html#persistent storage">persistent storage</a> for the predicate is kept, which in this case must be an external relational database. The description of this database is given through the <a class="idx_anchor" id="60" href="ciaoglindex.html#sql_persistent_location"><tt>sql_persistent_location</tt></a> predicate, which must contain a fact in which the first argument unifies with <span class="var">Keyword</span>. <span class="var">TableAttributes</span> provides the <a class="idx_anchor" id="61" href="ciaoglindex.html#table name">table name</a> and <a class="idx_anchor" id="62" href="ciaoglindex.html#attributes">attributes</a> in the database corresponding respectively to the predicate name and arguments of the (virtual) Prolog predicate.<p>Although a predicate may be persistent, other usual clauses can be defined in the source code. When querying a persistent predicate with non-persistent clauses, persistent and non-persisten clauses will be evaluated in turn; the order of evaluation is the usual Prolog order, considering that persistent clauses are defined in the program point where the <a class="idx_anchor" id="63" href="ciaoglindex.html#sql_persistent/3"><tt>sql_persistent/3</tt></a> declaration is.<p><strong>Example:</strong> <p><pre>:- sql_persistent(product( integer,    integer, string, string ),
              product( quantity,   id,      name,   size   ),
              radiowebdb).

sql_persistent_location(radiowebdb,
   db(&apos;SQL Anywhere 5.0 Sample&apos;, user, pass,
      &apos;r2d5.dia.fi.upm.es&apos;:2020)).
</pre> <LI><em>The following properties should hold upon exit:</em><br/><span class="on_right"> (persdbrt_mysql:prologPredTypes/1)</span><span><span class="var">PrologPredTypes</span> is a structure describing a Prolog predicate name with its types.
</span><br/><span class="on_right"> (persdbrt_mysql:tableAttributes/1)</span><span><span class="var">TableAttributes</span> is a structure describing a table name and some attributes.
</span><br/><span class="on_right"> (persdbrt_mysql:persLocId/1)</span><span><span class="var">Keyword</span> is the name of a persistent storage location.
</span>
</ul></div></div><p>
<div><span class="on_right">PREDICATE</span><div class="defname"><a class="idx_anchor" id="db_query/4" href="ciaopdindex.html#db_query/4">db_query/4</a>:</div><div class="deftext"><p><strong>Usage:</strong> <tt>db_query(DBId,ProjTerm,Goal,ResultTerm)</tt>
<ul class="itemize_minus"><LI><em>Description:</em> <span class="var">ResultTerm</span> contains all the <a class="idx_anchor" id="64" href="ciaoglindex.html#tuples">tuples</a> which are the response from database <span class="var">DBId</span> to the Prolog query <span class="var">Goal</span>, projected onto <span class="var">ProjTerm</span>. Uses <a class="idx_anchor" id="65" href="ciaoglindex.html#pl2sqlstring/3"><tt>pl2sqlstring/3</tt></a> for the <a class="idx_anchor" id="66" href="ciaoglindex.html#Prolog to SQL translation">Prolog to SQL translation</a> and <a class="idx_anchor" id="67" href="ciaoglindex.html#sql_query/3"><tt>sql_query/3</tt></a> for posing the actual query.<LI><em>Call and exit should be compatible with:</em><br/><span class="on_right"> (mysql_client:dbconnection/1)</span><span><span class="var">DBId</span> a unique identifier of a database session connection.
</span><br/><span class="on_right"> (pl2sql:projterm/1)</span><span><span class="var">ProjTerm</span> is a database projection term.
</span><br/><span class="on_right"> (pl2sql:querybody/1)</span><span><span class="var">Goal</span> is a database query goal.
</span><br/><span class="on_right"> (persdbrt_mysql:tuple/1)</span><span><span class="var">ResultTerm</span> is a tuple of values from the ODBC database interface.
</span>
<LI><em>The following properties should hold at call time:</em><br/><span class="on_right"> (term_typing:nonvar/1)</span><span><span class="var">DBId</span> is currently a term which is not a free variable.
</span><br/><span class="on_right"> (term_typing:nonvar/1)</span><span><span class="var">ProjTerm</span> is currently a term which is not a free variable.
</span><br/><span class="on_right"> (term_typing:nonvar/1)</span><span><span class="var">Goal</span> is currently a term which is not a free variable.
</span>
</ul></div></div><p>
<div><span class="on_right">PREDICATE</span><div class="defname"><a class="idx_anchor" id="db_query_one_tuple/4" href="ciaopdindex.html#db_query_one_tuple/4">db_query_one_tuple/4</a>:</div><div class="deftext"><p><strong>Usage:</strong> <tt>db_query_one_tuple(DBId,ProjTerm,Goal,ResultTerm)</tt>
<ul class="itemize_minus"><LI><em>Description:</em> <span class="var">ResultTerm</span> is one of the <a class="idx_anchor" id="68" href="ciaoglindex.html#tuples">tuples</a> which are the response from database <span class="var">DBId</span> to the Prolog query <span class="var">Goal</span>, projected onto <span class="var">ProjTerm</span>. Uses <a class="idx_anchor" id="69" href="ciaoglindex.html#pl2sqlstring/3"><tt>pl2sqlstring/3</tt></a> for the <a class="idx_anchor" id="70" href="ciaoglindex.html#Prolog to SQL translation">Prolog to SQL translation</a> and <a class="idx_anchor" id="71" href="ciaoglindex.html#sql_query_one_tuple/3"><tt>sql_query_one_tuple/3</tt></a> for posing the actual query. After last tuple has been reached, a null tuple is unified with ResultTerm, and the connection to the database finishes.<LI><em>Call and exit should be compatible with:</em><br/><span class="on_right"> (mysql_client:dbconnection/1)</span><span><span class="var">DBId</span> a unique identifier of a database session connection.
</span><br/><span class="on_right"> (pl2sql:projterm/1)</span><span><span class="var">ProjTerm</span> is a database projection term.
</span><br/><span class="on_right"> (pl2sql:querybody/1)</span><span><span class="var">Goal</span> is a database query goal.
</span><br/><span class="on_right"> (persdbrt_mysql:answertupleterm/1)</span><span><span class="var">ResultTerm</span> is a predicate containing a tuple.
</span>
<LI><em>The following properties should hold at call time:</em><br/><span class="on_right"> (term_typing:nonvar/1)</span><span><span class="var">DBId</span> is currently a term which is not a free variable.
</span><br/><span class="on_right"> (term_typing:nonvar/1)</span><span><span class="var">ProjTerm</span> is currently a term which is not a free variable.
</span><br/><span class="on_right"> (term_typing:nonvar/1)</span><span><span class="var">Goal</span> is currently a term which is not a free variable.
</span>
</ul></div></div><p>
<div><span class="on_right">PREDICATE</span><div class="defname"><a class="idx_anchor" id="sql_query_one_tuple/3" href="ciaopdindex.html#sql_query_one_tuple/3">sql_query_one_tuple/3</a>:</div><div class="deftext"><p><strong>Usage:</strong> <tt>sql_query_one_tuple(DBId,SQLString,ResultTuple)</tt>
<ul class="itemize_minus"><LI><em>Description:</em> <span class="var">ResultTuple</span> contains an element from the set of tuples which represents the response in <span class="var">DBId</span> to the <a class="idx_anchor" id="72" href="ciaoglindex.html#SQL query">SQL query</a> <span class="var">SQLString</span>. If the connection is kept, succesive calls return consecutive tuples, until the last tuple is reached. Then a null tuple is unified with <span class="var">ResultTuple</span> and the connection is finished (calls to <a class="idx_anchor" id="73" href="ciaoglindex.html#mysql_disconnect/1"><tt>mysql_disconnect/1</tt></a>).<LI><em>Call and exit should be compatible with:</em><br/><span class="on_right"> (mysql_client:dbconnection/1)</span><span><span class="var">DBId</span> a unique identifier of a database session connection.
</span><br/><span class="on_right"> (pl2sql:sqlstring/1)</span><span><span class="var">SQLString</span> is a string containing SQL code.
</span><br/><span class="on_right"> (persdbrt_mysql:tuple/1)</span><span><span class="var">ResultTuple</span> is a tuple of values from the ODBC database interface.
</span>
<LI><em>The following properties should hold at call time:</em><br/><span class="on_right"> (term_typing:nonvar/1)</span><span><span class="var">DBId</span> is currently a term which is not a free variable.
</span><br/><span class="on_right"> (term_typing:nonvar/1)</span><span><span class="var">SQLString</span> is currently a term which is not a free variable.
</span>
</ul></div></div><p>
</div><div id="Known bugs and planned improvements"><h2>Known bugs and planned improvements</h2><ul><LI>At least in the shell, reloading a file after changing the definition of a persistent predicate does not eliminate the old definition...<LI>Functionality missing: some questions need to be debugged.<LI>Warning: still using kludgey string2term and still using some non-uniquified temp files.<LI>Needs to be unified with the file-based library.</ul></div></div></div></div></div><div class="sidebarwrapper"><div class="sidebar"><IMG SRC="autofigciao-shadow-64h.png"><h2>Module Sections</h2><ul><LI><a href="#Implementation of the Database Interface">Implementation of the Database Interface</a><LI><a href="#Example(s)">Example(s)</a><LI><a href="#Usage and interface">Usage and interface</a><LI><a href="#Documentation on exports">Documentation on exports</a><LI><a href="#Documentation on multifiles">Documentation on multifiles</a><LI><a href="#Documentation on internals">Documentation on internals</a><LI><a href="#Known bugs and planned improvements">Known bugs and planned improvements</a></ul><h2>Global Links</h2><ul><LI><a href="ciaofulltoc.html">Table of Contents</a><LI><a href="ciaochanges.html">Version/Change Log</a><LI><a href="ciaorefs.html">References</a><LI><a href="ciaocopyright.html">Copyright</a></ul><h2>Indices</h2><ul><LI><a href="ciaoliindex.html">Library/Module Index</a><LI><a href="ciaopdindex.html">Predicate/Method Index</a><LI><a href="ciaoprindex.html">Property Index</a><LI><a href="ciaoteindex.html">Regular Type Index</a><LI><a href="ciaodeindex.html">Declaration Index</a><LI><a href="ciaocoindex.html">Concept Index</a><LI><a href="ciaoauindex.html">Author Index</a><LI><a href="ciaoglindex.html">Global Index</a></ul></div></div><div class="clearer"></div></div><div class="nav"><span class="on_right"><a class="navbutton" href="factsdb_rt.html">&#x25C4;</a><a class="navbutton" href="pl2sql.html">&#x25BA;</a></span><span>&nbsp;</span></div><div class="footer">Generated with LPdoc using Ciao</div></body></html>