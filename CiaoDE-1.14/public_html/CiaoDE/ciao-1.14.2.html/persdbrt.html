<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd"><html><head><meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1"/><link rel="stylesheet" href="lpdoc.css" type="text/css"/><title>Persistent predicate database &mdash; The Ciao System v1.14#2</title></head><body><div class="nav"><span class="on_right"><a class="navbutton" href="pillow_types.html">&#x25C4;</a><a class="navbutton" href="Examples.html">&#x25BA;</a></span><span><a href="ciao.html">The Ciao System</a> &raquo; <a href="Interfaces.html">PART VIII - Interfaces to other languages and systems</a> &raquo; </span></div><div class="documentwrapper"><div class="document"><div class="mainwrapper"><div class="main"><div id=""><h1>Persistent predicate database</h1><a class="idx_anchor" href="ciaoliindex.html#persdbrt"></a>
<strong>Author(s):</strong> <a class="idx_anchor" id="Jose Manuel Gomez Perez" href="ciaoauindex.html#Jose Manuel Gomez Perez">Jos&eacute; Manuel G&oacute;mez P&eacute;rez</a>, <a class="idx_anchor" id="Daniel Cabeza" href="ciaoauindex.html#Daniel Cabeza">Daniel Cabeza</a>, <a class="idx_anchor" id="Manuel Hermenegildo" href="ciaoauindex.html#Manuel Hermenegildo">Manuel Hermenegildo</a>, <a class="idx_anchor" id="The CLIP Group" href="ciaoauindex.html#The CLIP Group">The CLIP Group</a>.<p>
<p><div id="Introduction to persistent predicates"><h2>Introduction to persistent predicates</h2> <p>This library implements a <em>generic persistent predicate database</em>. The basic notion implemented by the library is that of a <a class="idx_anchor" id="0" href="ciaoglindex.html#persistent predicate">persistent predicate</a>. The persistent predicate concept provides a simple, yet powerful generic persistent data access method [<a href="ciaorefs.html#radioweb-D3.1.M1-A1">CHGT98</a>,<a href="ciaorefs.html#radioweb-ta">Par97</a>]. A persistent predicate is a special kind of dynamic, data predicate that &ldquo;resides&rdquo; in some persistent medium (such as a set of files, a database, etc.) that is typically external to the program using such predicates. The main effect is that any changes made to a persistent predicate from a program &ldquo;survive&rdquo; across executions. I.e., if the program is halted and restarted the predicate that the new process sees is in precisely the same state as it was when the old process was halted (provided no change was made in the meantime to the storage by other processes or the user).<p>Persistent predicates appear to a program as ordinary predicates, and calls to these predicates can appear in clause bodies in the usual way. However, the definitions of these predicates do not appear in the program. Instead, the library maintains automatically the definitions of predicates which have been declared as persistent in the persistent storage.<p><a class="idx_anchor" id="1" href="ciaoglindex.html#Updates to persistent predicates">Updates to persistent predicates</a> can be made using enhanced versions of <a class="idx_anchor" id="2" href="ciaoglindex.html#asserta_fact/1"><tt>asserta_fact/1</tt></a>, <a class="idx_anchor" id="3" href="ciaoglindex.html#assertz_fact/1"><tt>assertz_fact/1</tt></a> and <a class="idx_anchor" id="4" href="ciaoglindex.html#retract_fact/1"><tt>retract_fact/1</tt></a>. The library makes sure that each update is a <a class="idx_anchor" id="5" href="ciaoglindex.html#transactional update">transactional update</a>, in the sense that if the update terminates, then the permanent storage has definitely been modified. For example, if the program making the updates is halted just after the update and then restarted, then the updated state of the predicate will be seen. This provides security against possible data loss due to, for example, a system crash. Also, due to the atomicity of the transactions, persistent predicates allow <a class="idx_anchor" id="6" href="ciaoglindex.html#concurrent updates">concurrent updates</a> from several programs.<p></div><div id="Persistent predicates, files, and relational databases"><h2>Persistent predicates, files, and relational databases</h2> <p>The concept of persistent predicates provided by this library essentially implements a light-weight, simple, and at the same time powerful form of relational database (a <a class="idx_anchor" id="7" href="ciaoglindex.html#deductive database">deductive database</a>), and which is standalone, in the sense that it does not require external support, other than the file management capabilities provided by the operating system. This is due to the fact that the persistent predicates are in fact stored in one or more auxiliary files below a given directory.<p>This type of database is specially useful when building small to medium-sized standalone applications in Prolog which require persistent storage. In many cases it provides a much easier way of implementing such storage than using files under direct program control. For example, interactive applications can use persistent predicates to represent their internal state in a way that is close to the application. The persistence of such predicates then allows automatically restoring the state to that at the end of a previous session. Using persistent predicates amounts to simply declaring some predicates as such and eliminates having to worry about opening files, closing them, recovering from system crashes, etc.<p>In other cases, however, it may be convenient to use a relational database as persistent storage. This may be the case, for example, when the data already resides in such a database (where it is perhaps accessed also by other applications) or the volume of data is very large. <a class="idx_anchor" id="8" href="ciaoglindex.html#persdb_sql"><tt>persdb_sql</tt></a> [<a href="ciaorefs.html#radioweb-D3.1.M2-A2">CCG98</a>] is a companion library which implements the same notion of persistent predicates used herein, but keeping the storage in a relational database. This provides a very natural and transparent way to access SQL database relations from a Prolog program. In that library, facilities are also provided for reflecting more complex <em>views</em> of the database relations as predicates. Such views can be constructed as conjunctions, disjunctions, projections, etc. of database relations, and may include SQL-like aggregation operations.<p>A nice characteristic of the notion of persistent predicates used in both of these libraries is that it abstracts away how the predicate is actually stored. Thus, a program can use persistent predicates stored in files or in external relational databases interchangeably, and the type of storage used for a given predicate can be changed without having to modify the program (except for replacing the corresponding <a class="idx_anchor" id="9" href="ciaoglindex.html#persistent/2"><tt>persistent/2</tt></a> declarations).<p>An example application of the <a class="idx_anchor" id="10" href="ciaoglindex.html#persdb"><tt>persdb</tt></a> and <a class="idx_anchor" id="11" href="ciaoglindex.html#persdb_sql"><tt>persdb_sql</tt></a> libraries (and also the <a class="idx_anchor" id="12" href="ciaoglindex.html#pillow"><tt>pillow</tt></a> library [<a href="ciaorefs.html#pillow-www6">CH97</a>]), is <a class="idx_anchor" id="13" href="ciaoglindex.html#WebDB"><tt>WebDB</tt></a> [<a href="ciaorefs.html#radioweb-D3.1.M2-A3">GCH98</a>]. <a class="idx_anchor" id="14" href="ciaoglindex.html#WebDB"><tt>WebDB</tt></a> is a generic, highly customizable <em>deductive database engine</em> with an <em>html interface</em>. <a class="idx_anchor" id="15" href="ciaoglindex.html#WebDB"><tt>WebDB</tt></a> allows creating and maintaining Prolog-based databases as well as relational databases (residing in conventional relational database engines) using any standard WWW browser.<p></div><div id="Using file-based persistent predicates"><h2>Using file-based persistent predicates</h2> <p>Persistent predicates can be declared statically, using <a class="idx_anchor" id="16" href="ciaoglindex.html#persistent/2"><tt>persistent/2</tt></a> declarations (which is the preferred method, when possible), or dynamically via calls to <a class="idx_anchor" id="17" href="ciaoglindex.html#make_persistent/2"><tt>make_persistent/2</tt></a>. Currently, persistent predicates may only contain facts, i.e., they are <em>dynamic</em> predicates of type <a class="idx_anchor" id="18" href="ciaoglindex.html#data/1"><tt>data/1</tt></a>.<p>Predicates declared as persistent are linked to directory, and the persistent state of the predicate will be kept in several files below that directory. The files in which the persistent predicates are stored are in readable, plain ASCII format, and in Prolog syntax. One advantage of this approach is that such files can also be created or edited by hand, in a text editor, or even by other applications.<p>An example definition of a persistent predicate implemented by files follows:<p><pre>:- persistent(p/3,dbdir).

persistent_dir(dbdir, &apos;/home/clip/public_html/db&apos;).
</pre> <p>The first line declares the predicate <tt>p/3</tt> persistent. The argument <tt>dbdir</tt> is a key used to index into a fact of the relation <a class="idx_anchor" id="19" href="ciaoglindex.html#persistent_dir/2-4"><tt>persistent_dir/2-4</tt></a>, which specifies the directory where the corresponding files will be kept. The effect of the declaration, together with the <a class="idx_anchor" id="20" href="ciaoglindex.html#persistent_dir/2-4"><tt>persistent_dir/2-4</tt></a> fact, is that, although the predicate is handled in the same way as a normal data predicate, in addition the system will create and maintain efficiently a persistent version of <tt>p/3</tt> via files in the directory <tt>/home/clip/public_html/db</tt>.<p>The level of indirection provided by the <tt>dbdir</tt> argument makes it easy to place the storage of several persistent predicates in a common directory, by specifying the same key for all of them. It also allows changing the directory for several such persistent predicates by modifying only one fact in the program. Furthermore, the <a class="idx_anchor" id="21" href="ciaoglindex.html#persistent_dir/2-4"><tt>persistent_dir/2-4</tt></a> predicate can even be dynamic and specified at run-time.<p></div><div id="Implementation Issues"><h2>Implementation Issues</h2> <p>We outline the current implementation approach. This implementation attempts to provide at the same time efficiency and security. To this end, up to three files are used for each predicate (the <a class="idx_anchor" id="22" href="ciaoglindex.html#persistence set">persistence set</a>): the <a class="idx_anchor" id="23" href="ciaoglindex.html#data file">data file</a>, the <a class="idx_anchor" id="24" href="ciaoglindex.html#operations file">operations file</a>, and the <a class="idx_anchor" id="25" href="ciaoglindex.html#backup file">backup file</a>. In the <a class="idx_anchor" id="26" href="ciaoglindex.html#updated state">updated state</a> the facts (tuples) that define the predicate are stored in the data file and the operations file is empty (the backup file, which contains a security copy of the data file, may or may not exist).<p>While a program using a persistent predicate is running, any insertion (assert) or deletion (retract) operations on the predicate are performed on both the program memory and on the persistence set. However, in order to incurr only a small overhead in the execution, rather than changing the data file directly, a record of each of the insertion and deletion operations is <em>appended</em> to the operations file. The predicate is then in a <a class="idx_anchor" id="27" href="ciaoglindex.html#transient state">transient state</a>, in that the contents of the data file do not reflect exactly the current state of the corresponding predicate. However, the complete persistence set does.<p>When a program starts, all pending operations in the operations file are performed on the data file. A backup of the data file is created first to prevent data loss if the system crashes during this operation. The order in which this updating of files is done ensures that, if at any point the process dies, on restart the data will be completely recovered. This process of updating the persistence set can also be triggered at any point in the execution of the program (for example, when halting) by calling <a class="idx_anchor" id="28" href="ciaoglindex.html#update_files"><tt>update_files</tt></a>.<p></div><div id="Defining an initial database"><h2>Defining an initial database</h2> <p>It is possible to define an initial database by simply including in the program code facts of persistent predicates. They will be included in the persistent database when it is created. They are ignored in successive executions.<p></div><div id="Using persistent predicates from the top level"><h2>Using persistent predicates from the top level</h2> <p>Special care must be taken when loading into the top level modules or user files which use persistent predicates. Beforehand, a goal <tt>use_module(library(persdb(persdbrt)))</tt> must be issued. Furthermore, since persistent predicates defined by the loaded files are in this way defined dynamically, a call to <a class="idx_anchor" id="29" href="ciaoglindex.html#initialize_db/0"><tt>initialize_db/0</tt></a> is commonly needed after loading and before calling predicates of these files. </div><br/><div id="Usage and interface"><h2>Usage and interface</h2><div class="cartouche"><ul><LI><strong>Library usage:</strong><br/>There are two packages which implement persistence: <a class="idx_anchor" id="30" href="ciaoglindex.html#persdb"><tt>persdb</tt></a> and <a class="idx_anchor" id="31" href="ciaoglindex.html#&apos;persdb/ll&apos;"><tt>&apos;persdb/ll&apos;</tt></a> (for low level). In the first, the standard builtins <a class="idx_anchor" id="32" href="ciaoglindex.html#asserta_fact/1"><tt>asserta_fact/1</tt></a>, <a class="idx_anchor" id="33" href="ciaoglindex.html#assertz_fact/1"><tt>assertz_fact/1</tt></a>, and <a class="idx_anchor" id="34" href="ciaoglindex.html#retract_fact/1"><tt>retract_fact/1</tt></a> are replaced by new versions which handle persistent data predicates, behaving as usual for normal data predicates. In the second package, predicates with names starting with <tt>p</tt> are defined, so that there is no overhead in calling the standard builtins. In any case, each package is used as usual: including it in the package list of the module, or using the <a class="idx_anchor" id="35" href="ciaoglindex.html#use_package/1"><tt>use_package/1</tt></a> declaration.<LI><strong>Exports:</strong><br/><ul class="itemize_minus"><LI><em>Predicates:</em><br/><a class="idx_anchor" id="36" href="ciaoglindex.html#passerta_fact/1"><tt>passerta_fact/1</tt></a>, <a class="idx_anchor" id="37" href="ciaoglindex.html#passertz_fact/1"><tt>passertz_fact/1</tt></a>, <a class="idx_anchor" id="38" href="ciaoglindex.html#pretract_fact/1"><tt>pretract_fact/1</tt></a>, <a class="idx_anchor" id="39" href="ciaoglindex.html#pretractall_fact/1"><tt>pretractall_fact/1</tt></a>, <a class="idx_anchor" id="40" href="ciaoglindex.html#asserta_fact/1"><tt>asserta_fact/1</tt></a>, <a class="idx_anchor" id="41" href="ciaoglindex.html#assertz_fact/1"><tt>assertz_fact/1</tt></a>, <a class="idx_anchor" id="42" href="ciaoglindex.html#retract_fact/1"><tt>retract_fact/1</tt></a>, <a class="idx_anchor" id="43" href="ciaoglindex.html#retractall_fact/1"><tt>retractall_fact/1</tt></a>, <a class="idx_anchor" id="44" href="ciaoglindex.html#initialize_db/0"><tt>initialize_db/0</tt></a>, <a class="idx_anchor" id="45" href="ciaoglindex.html#make_persistent/2"><tt>make_persistent/2</tt></a>, <a class="idx_anchor" id="46" href="ciaoglindex.html#update_files/0"><tt>update_files/0</tt></a>, <a class="idx_anchor" id="47" href="ciaoglindex.html#update_files/1"><tt>update_files/1</tt></a>, <a class="idx_anchor" id="48" href="ciaoglindex.html#create/2"><tt>create/2</tt></a>.
<LI><em>Regular Types:</em><br/><a class="idx_anchor" id="49" href="ciaoglindex.html#meta_predname/1"><tt>meta_predname/1</tt></a>, <a class="idx_anchor" id="50" href="ciaoglindex.html#directoryname/1"><tt>directoryname/1</tt></a>.
<LI><em>Multifiles:</em><br/><a class="idx_anchor" id="51" href="ciaoglindex.html#$is_persistent/2"><tt>$is_persistent/2</tt></a>, <a class="idx_anchor" id="52" href="ciaoglindex.html#persistent_dir/2"><tt>persistent_dir/2</tt></a>, <a class="idx_anchor" id="53" href="ciaoglindex.html#persistent_dir/4"><tt>persistent_dir/4</tt></a>.
</ul><LI><strong>Other modules used:</strong><br/><ul class="itemize_minus"><LI><em>System library modules:</em><br/><a class="idx_anchor" id="54" href="ciaoglindex.html#lists"><tt>lists</tt></a>, <a class="idx_anchor" id="55" href="ciaoglindex.html#read"><tt>read</tt></a>, <a class="idx_anchor" id="56" href="ciaoglindex.html#aggregates"><tt>aggregates</tt></a>, <a class="idx_anchor" id="57" href="ciaoglindex.html#system"><tt>system</tt></a>, <a class="idx_anchor" id="58" href="ciaoglindex.html#file_locks/file_locks"><tt>file_locks/file_locks</tt></a>, <a class="idx_anchor" id="59" href="ciaoglindex.html#persdb/persdbcache"><tt>persdb/persdbcache</tt></a>.
</ul></ul></div></div><div id="Documentation on exports"><h2>Documentation on exports</h2><div><span class="on_right">PREDICATE</span><div class="defname"><a class="idx_anchor" id="passerta_fact/1" href="ciaopdindex.html#passerta_fact/1">passerta_fact/1</a>:</div><div class="deftext"><br/>
<em>Meta-predicate</em> with arguments: <tt>passerta_fact(fact)</tt>.<br/><p><strong>Usage:</strong> <tt>passerta_fact(Fact)</tt>
<ul class="itemize_minus"><LI><em>Description:</em> Persistent version of <a class="idx_anchor" id="60" href="ciaoglindex.html#asserta_fact/1"><tt>asserta_fact/1</tt></a>: the current instance of <span class="var">Fact</span> is interpreted as a fact (i.e., a relation tuple) and is added at the beginning of the definition of the corresponding predicate. The predicate concerned must be declared <a class="idx_anchor" id="61" href="ciaoglindex.html#persistent"><tt>persistent</tt></a>. Any uninstantiated variables in the <span class="var">Fact</span> will be replaced by new, private variables. Defined in the <a class="idx_anchor" id="62" href="ciaoglindex.html#&apos;persdb/ll&apos;"><tt>&apos;persdb/ll&apos;</tt></a> package.<LI><em>The following properties should hold at call time:</em><br/><span class="on_right"> (basic_props:callable/1)</span><span><span class="var">Fact</span> is a term which represents a goal, i.e., an atom or a structure.
</span>
</ul></div></div><p>
<div><span class="on_right">PREDICATE</span><div class="defname"><a class="idx_anchor" id="passertz_fact/1" href="ciaopdindex.html#passertz_fact/1">passertz_fact/1</a>:</div><div class="deftext"><br/>
<em>Meta-predicate</em> with arguments: <tt>passertz_fact(fact)</tt>.<br/><p><strong>Usage:</strong> <tt>passertz_fact(Fact)</tt>
<ul class="itemize_minus"><LI><em>Description:</em> Persistent version of <a class="idx_anchor" id="63" href="ciaoglindex.html#assertz_fact/1"><tt>assertz_fact/1</tt></a>: the current instance of <span class="var">Fact</span> is interpreted as a fact (i.e., a relation tuple) and is added at the end of the definition of the corresponding predicate. The predicate concerned must be declared <a class="idx_anchor" id="64" href="ciaoglindex.html#persistent"><tt>persistent</tt></a>. Any uninstantiated variables in the <span class="var">Fact</span> will be replaced by new, private variables. Defined in the <a class="idx_anchor" id="65" href="ciaoglindex.html#&apos;persdb/ll&apos;"><tt>&apos;persdb/ll&apos;</tt></a> package.<LI><em>The following properties should hold at call time:</em><br/><span class="on_right"> (basic_props:callable/1)</span><span><span class="var">Fact</span> is a term which represents a goal, i.e., an atom or a structure.
</span>
</ul></div></div><p>
<div><span class="on_right">PREDICATE</span><div class="defname"><a class="idx_anchor" id="pretract_fact/1" href="ciaopdindex.html#pretract_fact/1">pretract_fact/1</a>:</div><div class="deftext"><tt>pretract_fact(P)</tt>
<p>Retracts a predicate in both, the dynamic and the persistent databases.<br/>
<em>Meta-predicate</em> with arguments: <tt>pretract_fact(fact)</tt>.<br/><p><strong>Usage:</strong> <tt>pretract_fact(Fact)</tt>
<ul class="itemize_minus"><LI><em>Description:</em> Persistent version of <a class="idx_anchor" id="66" href="ciaoglindex.html#retract_fact/1"><tt>retract_fact/1</tt></a>: deletes on backtracking all the facts which unify with <span class="var">Fact</span>. The predicate concerned must be declared <a class="idx_anchor" id="67" href="ciaoglindex.html#persistent"><tt>persistent</tt></a>. Defined in the <a class="idx_anchor" id="68" href="ciaoglindex.html#&apos;persdb/ll&apos;"><tt>&apos;persdb/ll&apos;</tt></a> package.<LI><em>The following properties should hold at call time:</em><br/><span class="on_right"> (basic_props:callable/1)</span><span><span class="var">Fact</span> is a term which represents a goal, i.e., an atom or a structure.
</span>
</ul></div></div><p>
<div><span class="on_right">PREDICATE</span><div class="defname"><a class="idx_anchor" id="pretractall_fact/1" href="ciaopdindex.html#pretractall_fact/1">pretractall_fact/1</a>:</div><div class="deftext"><tt>pretractall_fact(P)</tt>
<p>Retracts all the instances of a predicate in both, the dynamic and the persistent databases.<br/>
<em>Meta-predicate</em> with arguments: <tt>pretractall_fact(fact)</tt>.<br/></div></div><p>
<div><span class="on_right">PREDICATE</span><div class="defname"><a class="idx_anchor" id="asserta_fact/1" href="ciaopdindex.html#asserta_fact/1">asserta_fact/1</a>:</div><div class="deftext"><br/>
<em>Meta-predicate</em> with arguments: <tt>asserta_fact(fact)</tt>.<br/><p><strong>Usage:</strong> <tt>asserta_fact(Fact)</tt>
<ul class="itemize_minus"><LI><em>Description:</em> Same as <a class="idx_anchor" id="69" href="ciaoglindex.html#passerta_fact/1"><tt>passerta_fact/1</tt></a>, but if the predicate concerned is not persistent then behaves as the builtin of the same name. Defined in the <a class="idx_anchor" id="70" href="ciaoglindex.html#persdb"><tt>persdb</tt></a> package.<LI><em>The following properties should hold at call time:</em><br/><span class="on_right"> (basic_props:callable/1)</span><span><span class="var">Fact</span> is a term which represents a goal, i.e., an atom or a structure.
</span>
</ul></div></div><p>
<div><span class="on_right">PREDICATE</span><div class="defname"><a class="idx_anchor" id="assertz_fact/1" href="ciaopdindex.html#assertz_fact/1">assertz_fact/1</a>:</div><div class="deftext"><br/>
<em>Meta-predicate</em> with arguments: <tt>assertz_fact(fact)</tt>.<br/><p><strong>Usage:</strong> <tt>assertz_fact(Fact)</tt>
<ul class="itemize_minus"><LI><em>Description:</em> Same as <a class="idx_anchor" id="71" href="ciaoglindex.html#passertz_fact/1"><tt>passertz_fact/1</tt></a>, but if the predicate concerned is not persistent then behaves as the builtin of the same name. Defined in the <a class="idx_anchor" id="72" href="ciaoglindex.html#persdb"><tt>persdb</tt></a> package.<LI><em>The following properties should hold at call time:</em><br/><span class="on_right"> (basic_props:callable/1)</span><span><span class="var">Fact</span> is a term which represents a goal, i.e., an atom or a structure.
</span>
</ul></div></div><p>
<div><span class="on_right">PREDICATE</span><div class="defname"><a class="idx_anchor" id="retract_fact/1" href="ciaopdindex.html#retract_fact/1">retract_fact/1</a>:</div><div class="deftext"><br/>
<em>Meta-predicate</em> with arguments: <tt>retract_fact(fact)</tt>.<br/><p><strong>Usage:</strong> <tt>retract_fact(Fact)</tt>
<ul class="itemize_minus"><LI><em>Description:</em> Same as <a class="idx_anchor" id="73" href="ciaoglindex.html#pretract_fact/1"><tt>pretract_fact/1</tt></a>, but if the predicate concerned is not persistent then behaves as the builtin of the same name. Defined in the <a class="idx_anchor" id="74" href="ciaoglindex.html#persdb"><tt>persdb</tt></a> package.<LI><em>The following properties should hold at call time:</em><br/><span class="on_right"> (basic_props:callable/1)</span><span><span class="var">Fact</span> is a term which represents a goal, i.e., an atom or a structure.
</span>
</ul></div></div><p>
<div><span class="on_right">PREDICATE</span><div class="defname"><a class="idx_anchor" id="retractall_fact/1" href="ciaopdindex.html#retractall_fact/1">retractall_fact/1</a>:</div><div class="deftext"><br/>
<em>Meta-predicate</em> with arguments: <tt>retractall_fact(fact)</tt>.<br/><p><strong>Usage:</strong> <tt>retractall_fact(Fact)</tt>
<ul class="itemize_minus"><LI><em>Description:</em> Same as <a class="idx_anchor" id="75" href="ciaoglindex.html#pretractall_fact/1"><tt>pretractall_fact/1</tt></a>, but if the predicate concerned is not persistent then behaves as the builtin of the same name. Defined in the <a class="idx_anchor" id="76" href="ciaoglindex.html#persdb"><tt>persdb</tt></a> package.<LI><em>The following properties should hold at call time:</em><br/><span class="on_right"> (basic_props:callable/1)</span><span><span class="var">Fact</span> is a term which represents a goal, i.e., an atom or a structure.
</span>
</ul></div></div><p>
<div><span class="on_right">PREDICATE</span><div class="defname"><a class="idx_anchor" id="initialize_db/0" href="ciaopdindex.html#initialize_db/0">initialize_db/0</a>:</div><div class="deftext"><p><strong>Usage:</strong> <ul class="itemize_minus"><LI><em>Description:</em> <a class="idx_anchor" id="77" href="ciaocoindex.html#database initialization"></a> Initializes the whole database, updating the state of the declared persistent predicates. Must be called explicitly after dynamically defining clauses for <a class="idx_anchor" id="78" href="ciaoglindex.html#persistent_dir/2"><tt>persistent_dir/2</tt></a>.</ul></div></div><p>
<div><span class="on_right">PREDICATE</span><div class="defname"><a class="idx_anchor" id="make_persistent/2" href="ciaopdindex.html#make_persistent/2">make_persistent/2</a>:</div><div class="deftext"><br/>
<em>Meta-predicate</em> with arguments: <tt>make_persistent(spec,?)</tt>.<br/><p><strong>Usage:</strong> <tt>make_persistent(PredDesc,Keyword)</tt>
<ul class="itemize_minus"><LI><em>Description:</em> Dynamic version of the <a class="idx_anchor" id="79" href="ciaoglindex.html#persistent"><tt>persistent</tt></a> declaration.<LI><em>The following properties should hold at call time:</em><br/><span class="on_right"> (persdbrt:meta_predname/1)</span><span>persdbrt:meta_predname(PredDesc)
</span><br/><span class="on_right"> (persdbcache:keyword/1)</span><span><span class="var">Keyword</span> is an atom corresponding to a directory identifier.
</span>
</ul></div></div><p>
<div><span class="on_right">PREDICATE</span><div class="defname"><a class="idx_anchor" id="update_files/0" href="ciaopdindex.html#update_files/0">update_files/0</a>:</div><div class="deftext"><p><strong>Usage:</strong> <ul class="itemize_minus"><LI><em>Description:</em> Updates the files comprising the persistence set of all persistent predicates defined in the application.</ul></div></div><p>
<div><span class="on_right">PREDICATE</span><div class="defname"><a class="idx_anchor" id="update_files/1" href="ciaopdindex.html#update_files/1">update_files/1</a>:</div><div class="deftext"><br/>
<em>Meta-predicate</em> with arguments: <tt>update_files(list(spec))</tt>.<br/><p><strong>Usage:</strong> <tt>update_files(PredSpecList)</tt>
<ul class="itemize_minus"><LI><em>Description:</em> Updates the files comprising the persistence set of the persistent predicates in <span class="var">PredSpecList</span>.<LI><em>Call and exit should be compatible with:</em><br/><span class="on_right"> (basic_props:list/2)</span><span><span class="var">PredSpecList</span> is a list of <span class="var">predname</span>s.
</span>
</ul></div></div><p>
<div><span class="on_right">PREDICATE</span><div class="defname"><a class="idx_anchor" id="create/2" href="ciaopdindex.html#create/2">create/2</a>:</div><div class="deftext">No further documentation available for this predicate.</div></div><p>
<div><span class="on_right">REGTYPE</span><div class="defname"><a class="idx_anchor" id="meta_predname/1" href="ciaoteindex.html#meta_predname/1">meta_predname/1</a>:</div><div class="deftext">A regular type, defined as follows:<pre>meta_predname($:(P)) :-
        predname(P).
</pre> </div></div><p>
<div><span class="on_right">REGTYPE</span><div class="defname"><a class="idx_anchor" id="directoryname/1" href="ciaoteindex.html#directoryname/1">directoryname/1</a>:</div><div class="deftext"><p><strong>Usage:</strong> <tt>directoryname(X)</tt>
<ul class="itemize_minus"><LI><em>Description:</em> <span class="var">X</span> is an atom, the name of a directory.</ul></div></div><p>
</div><div id="Documentation on multifiles"><h2>Documentation on multifiles</h2><div><span class="on_right">PREDICATE</span><div class="defname"><a class="idx_anchor" id="$is_persistent/2" href="ciaopdindex.html#$is_persistent/2">$is_persistent/2</a>:</div><div class="deftext"><tt>$is_persistent(Spec,Key)</tt>
<p>Predicate <span class="var">Spec</span> persists within database <span class="var">Key</span>. Programmers should not define this predicate directly in the program.<br/>
The predicate is <em>multifile</em>.<br/>
The predicate is of type <em>data</em>.<br/></div></div><p>
<div><span class="on_right">PREDICATE</span><div class="defname"><a class="idx_anchor" id="persistent_dir/2" href="ciaopdindex.html#persistent_dir/2">persistent_dir/2</a>:</div><div class="deftext"><br/>
The predicate is <em>multifile</em>.<br/>
The predicate is of type <em>data</em>.<br/><p><strong>Usage:</strong> <tt>persistent_dir(Keyword,Location_Path)</tt>
<ul class="itemize_minus"><LI><em>Description:</em> Relates identifiers of locations (the <span class="var">Keyword</span>s) with descriptions of such locations (<span class="var">Location_Path</span>s). <span class="var">Location_Path</span> is <strong>a directory</strong> and it means that the definition for the persistent predicates associated with <span class="var">Keyword</span> is kept in files below that directory (which must previously exist). These files, in the updated state, contain the actual definition of the predicate in Prolog syntax (but with module names resolved).<LI><em>Call and exit should be compatible with:</em><br/><span class="on_right"> (persdbcache:keyword/1)</span><span><span class="var">Keyword</span> is an atom corresponding to a directory identifier.
</span><br/><span class="on_right"> (persdbrt:directoryname/1)</span><span><span class="var">Location_Path</span> is an atom, the name of a directory.
</span>
</ul></div></div><p>
<div><span class="on_right">PREDICATE</span><div class="defname"><a class="idx_anchor" id="persistent_dir/4" href="ciaopdindex.html#persistent_dir/4">persistent_dir/4</a>:</div><div class="deftext"><br/>
The predicate is <em>multifile</em>.<br/>
The predicate is of type <em>data</em>.<br/><p><strong>Usage:</strong> <tt>persistent_dir(Keyword,Location_Path,DirPerms,FilePerms)</tt>
<ul class="itemize_minus"><LI><em>Description:</em> The same as <a class="idx_anchor" id="80" href="ciaoglindex.html#persistent_dir/2"><tt>persistent_dir/2</tt></a>, but including also the permission modes for persistent directories and files.<LI><em>Call and exit should be compatible with:</em><br/><span class="on_right"> (persdbcache:keyword/1)</span><span><span class="var">Keyword</span> is an atom corresponding to a directory identifier.
</span><br/><span class="on_right"> (persdbrt:directoryname/1)</span><span><span class="var">Location_Path</span> is an atom, the name of a directory.
</span><br/><span class="on_right"> (basic_props:int/1)</span><span><span class="var">DirPerms</span> is an integer.
</span><br/><span class="on_right"> (basic_props:int/1)</span><span><span class="var">FilePerms</span> is an integer.
</span>
</ul></div></div><p>
</div><div id="Documentation on internals"><h2>Documentation on internals</h2><div><span class="on_right">DECLARATION</span><div class="defname"><a class="idx_anchor" id="persistent/2" href="ciaodeindex.html#persistent/2">persistent/2</a>:</div><div class="deftext"><p><strong>Usage:</strong> :- <tt>persistent(PredDesc,Keyword)</tt>.
<ul class="itemize_minus"><LI><em>Description:</em> Declares the predicate <span class="var">PredDesc</span> as persistent. <span class="var">Keyword</span> is the <a class="idx_anchor" id="81" href="ciaoglindex.html#identifier of a location">identifier of a location</a> where the persistent storage for the predicate is kept. The location <span class="var">Keyword</span> is described in the <a class="idx_anchor" id="82" href="ciaoglindex.html#persistent_dir"><tt>persistent_dir</tt></a> predicate, which must contain a fact in which the first argument unifies with <span class="var">Keyword</span>.<LI><em>The following properties should hold upon exit:</em><br/><span class="on_right"> (basic_props:predname/1)</span><span><span class="var">PredDesc</span> is a Name/Arity structure denoting a predicate name: <pre>predname(P/A) :-
        atm(P),
        nnegint(A).
</pre>
</span><br/><span class="on_right"> (persdbcache:keyword/1)</span><span><span class="var">Keyword</span> is an atom corresponding to a directory identifier.
</span>
</ul></div></div><p>
<div><span class="on_right">PREDICATE</span><div class="defname"><a class="idx_anchor" id="keyword/1" href="ciaopdindex.html#keyword/1">keyword/1</a>:</div><div class="deftext">An atom which identifies a fact of the <a class="idx_anchor" id="83" href="ciaoglindex.html#persistent_dir/2"><tt>persistent_dir/2</tt></a> relation. This fact relates this atom to a directory in which the persistent storage for one or more persistent predicates is kept. Storage is expected under a subdirectory by the name of the module and in a file by the name of the predicate.</div></div><p>
</div><div id="Known bugs and planned improvements"><h2>Known bugs and planned improvements</h2><ul><LI>Run-time checks have been reported not to work with this code. That means that either the assertions here, or the code that implements the run-time checks are erroneous.<LI>To load in the toplevel a file which uses this package, module <tt>library(persdb(persdbrt))</tt> has to be previously loaded.</ul></div></div></div></div></div><div class="sidebarwrapper"><div class="sidebar"><IMG SRC="autofigciao-shadow-64h.png"><h2>Module Sections</h2><ul><LI><a href="#Introduction to persistent predicates">Introduction to persistent predicates</a><LI><a href="#Persistent predicates, files, and relational databases">Persistent predicates, files, and relational databases</a><LI><a href="#Using file-based persistent predicates">Using file-based persistent predicates</a><LI><a href="#Implementation Issues">Implementation Issues</a><LI><a href="#Defining an initial database">Defining an initial database</a><LI><a href="#Using persistent predicates from the top level">Using persistent predicates from the top level</a><LI><a href="#Usage and interface">Usage and interface</a><LI><a href="#Documentation on exports">Documentation on exports</a><LI><a href="#Documentation on multifiles">Documentation on multifiles</a><LI><a href="#Documentation on internals">Documentation on internals</a><LI><a href="#Known bugs and planned improvements">Known bugs and planned improvements</a></ul><h2>Submodules</h2><ul><LI><a href="Examples.html">Using the persdb library</a></ul><h2>Global Links</h2><ul><LI><a href="ciaofulltoc.html">Table of Contents</a><LI><a href="ciaochanges.html">Version/Change Log</a><LI><a href="ciaorefs.html">References</a><LI><a href="ciaocopyright.html">Copyright</a></ul><h2>Indices</h2><ul><LI><a href="ciaoliindex.html">Library/Module Index</a><LI><a href="ciaopdindex.html">Predicate/Method Index</a><LI><a href="ciaoprindex.html">Property Index</a><LI><a href="ciaoteindex.html">Regular Type Index</a><LI><a href="ciaodeindex.html">Declaration Index</a><LI><a href="ciaocoindex.html">Concept Index</a><LI><a href="ciaoauindex.html">Author Index</a><LI><a href="ciaoglindex.html">Global Index</a></ul></div></div><div class="clearer"></div></div><div class="nav"><span class="on_right"><a class="navbutton" href="pillow_types.html">&#x25C4;</a><a class="navbutton" href="Examples.html">&#x25BA;</a></span><span>&nbsp;</span></div><div class="footer">Generated with LPdoc using Ciao</div></body></html>