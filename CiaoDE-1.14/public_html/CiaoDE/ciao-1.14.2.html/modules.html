<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd"><html><head><meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1"/><link rel="stylesheet" href="lpdoc.css" type="text/css"/><title>The module system &mdash; The Ciao System v1.14#2</title></head><body><div class="nav"><span class="on_right"><a class="navbutton" href="Builtins.html">&#x25C4;</a><a class="navbutton" href="loading_code.html">&#x25BA;</a></span><span><a href="ciao.html">The Ciao System</a> &raquo; <a href="Builtins.html">PART II - The Ciao basic language (engine)</a> &raquo; </span></div><div class="documentwrapper"><div class="document"><div class="mainwrapper"><div class="main"><div id=""><h1>The module system</h1><a class="idx_anchor" href="ciaoliindex.html#modules"></a>
<strong>Author(s):</strong> <a class="idx_anchor" id="Daniel Cabeza" href="ciaoauindex.html#Daniel Cabeza">Daniel Cabeza</a>, <a class="idx_anchor" id="The CLIP Group" href="ciaoauindex.html#The CLIP Group">The CLIP Group</a>.<p>
Modularity is a basic notion in a modern computer language. Modules allow dividing programs in several parts, which have its own independent name spaces. The module system in Ciao [<a href="ciaorefs.html#ciao-modules-cl2000">CH00a</a>], as in many other Prolog implementations, is procedure based. This means that predicate names are local to a module, but functor/atom names in data are shared (at least by default).<p>The predicates visible in a module are the predicates defined in that module, plus the predicates imported from other modules. Only predicates exported by a module can be imported from other modules. The default module of a given predicate name is the local one if the predicate is defined locally, else the last module from which the predicate is imported, where explicit imports have priority over implicit ones (that is, a predicate imported through a <tt>use_module/2</tt> declaration is always preferred over a predicate imported through a <tt>use_module/1</tt> declaration). To refer to a predicate from a module which is not the default module for that predicate the name has to be module <a class="idx_anchor" id="0" href="ciaocoindex.html#module qualification"></a>qualified. A module qualified predicate name has the form <span class="var">Module</span>:<span class="var">Predicate</span> as in the call <tt>debugger:debug_module(M)</tt>. Note that in Ciao this module qualification cannot be used for gaining access to predicates that have not been imported, nor for defining clauses of other modules.<p>All predicates defined in files with no module declaration belong to a special module called <a class="idx_anchor" id="1" href="ciaocoindex.html#user module"></a> <tt>user</tt>, from which they are all implicitly exported. This provides backward compatibility for programs written for implementations with no module system and allows dividing programs into several files without being aware of the module system at all. Note that this feature is only supported for the above-mentioned backward-compatibility reasons, and the use of <tt>user</tt> files is discouraged. Many attractive compilation features of Ciao cannot be supported for <tt>user</tt> modules.<p>The case of multifile predicates (defined with the declaration <a class="idx_anchor" id="2" href="ciaoglindex.html#multifile/1"><tt>multifile/1</tt></a>) is also special. Multifile predicates can be defined by clauses distributed in several modules, and all modules which define a predicate as multifile can use that predicate. The name space of multifile predicates is independent, as if they belonged to the special module <tt>multifile</tt>.<p>Every <tt>user</tt> or module file imports implicitly a number of modules called <a class="idx_anchor" id="3" href="ciaoglindex.html#builtin modules">builtin modules</a>. They are imported before all other importations of the module, thus allowing the redefinition of any of their predicates (with the exception of <a class="idx_anchor" id="4" href="ciaoglindex.html#true/0"><tt>true/0</tt></a>) by defining local versions or importing them from other modules. Importing explicitly from a builtin module, however, disables the implicit importation of the rest (this feature is used by package <a class="idx_anchor" id="5" href="ciaoglindex.html#library(pure)"><tt>library(pure)</tt></a> to define pure Prolog code).<br/><div id="Usage and interface"><h2>Usage and interface</h2><div class="cartouche"><ul><LI><strong>Library usage:</strong><br/>Modules are an intrinsic feature of Ciao, so nothing special has to be done to use them.</ul></div></div><div id="Documentation on internals"><h2>Documentation on internals</h2><div><span class="on_right">DECLARATION</span><div class="defname"><a class="idx_anchor" id="module/3" href="ciaodeindex.html#module/3">module/3</a>:</div><div class="deftext"><p><strong>Usage:</strong> :- <tt>module(Name,Exports,Packages)</tt>.
<ul class="itemize_minus"><LI><em>Description:</em> Declares a module of name <span class="var">Name</span> which exports the predicates in <span class="var">Exports</span>, and uses the packages in <span class="var">Packages</span>. <span class="var">Name</span> must match with the name of the file where the module resides, without extension. For each source in <span class="var">Packages</span>, a <a class="idx_anchor" id="6" href="ciaoglindex.html#package file">package file</a> is used. If the source is specified with a <a class="idx_anchor" id="7" href="ciaoglindex.html#path alias">path alias</a>, this is the file included, if it is an atom, the library paths are searched. See <a class="idx_anchor" id="8" href="ciaoglindex.html#package/1"><tt>package/1</tt></a> for a brief description of package files.<p>This directive must appear the first in the file.<p>Also, if the compiler finds an unknown declaration as the first term in a file, the name of the declaration is regarded as a package library to be included, and the arguments of the declaration (if present) are interpreted like the arguments of <a class="idx_anchor" id="9" href="ciaoglindex.html#module/3"><tt>module/3</tt></a>.<LI><em>The following properties hold at call time:</em><br/><span class="on_right"> (modules:modulename/1)</span><span><span class="var">Name</span> is a module name (an atom).
</span><br/><span class="on_right"> (basic_props:list/2)</span><span><span class="var">Exports</span> is a list of <span class="var">predname</span>s.
</span><br/><span class="on_right"> (basic_props:list/2)</span><span><span class="var">Packages</span> is a list of <span class="var">sourcename</span>s.
</span>
</ul></div></div><p>
<div><span class="on_right">DECLARATION</span><div class="defname"><a class="idx_anchor" id="module/2" href="ciaodeindex.html#module/2">module/2</a>:</div><div class="deftext"><p><strong>Usage:</strong> :- <tt>module(Name,Exports)</tt>.
<ul class="itemize_minus"><LI><em>Description:</em> Same as directive <a class="idx_anchor" id="10" href="ciaoglindex.html#module/3"><tt>module/3</tt></a>, with an implicit package <tt>default</tt>. This default package provides all the standard features provided by most Prolog systems so that Prolog programs with traditional <a class="idx_anchor" id="11" href="ciaoglindex.html#module/2"><tt>module/2</tt></a> declarations can run without any change.<LI><em>The following properties hold at call time:</em><br/><span class="on_right"> (modules:modulename/1)</span><span><span class="var">Name</span> is a module name (an atom).
</span><br/><span class="on_right"> (basic_props:list/2)</span><span><span class="var">Exports</span> is a list of <span class="var">predname</span>s.
</span>
</ul></div></div><p>
<div><span class="on_right">DECLARATION</span><div class="defname"><a class="idx_anchor" id="package/1" href="ciaodeindex.html#package/1">package/1</a>:</div><div class="deftext"><p><strong>Usage:</strong> :- <tt>package(Name)</tt>.
<ul class="itemize_minus"><LI><em>Description:</em> Declares a package of name <span class="var">Name</span>. Like in modules, <span class="var">Name</span> must match with the name of the file where the package resides, without extension. This directive must appear the first in the file.<p>Package files provide syntactic extensions and their related functionalities by defining operators, new declarations, code translations, etc., as well as declaring imports from other modules and defining additional code. Most Ciao syntactic and semantic extensions, such as functional syntax, constraint solving, or breadth-first search are implemented as packages.<LI><em>The following properties hold at call time:</em><br/><span class="on_right"> (modules:modulename/1)</span><span><span class="var">Name</span> is a module name (an atom).
</span>
</ul></div></div><p>
<div><span class="on_right">DECLARATION</span><div class="defname"><a class="idx_anchor" id="export/1" href="ciaodeindex.html#export/1">export/1</a>:</div><div class="deftext"><p><strong>Usage 1:</strong> :- <tt>export(Pred)</tt>.
<ul class="itemize_minus"><LI><em>Description:</em> Adds <span class="var">Pred</span> to the set of exported predicates.<LI><em>The following properties hold at call time:</em><br/><span class="on_right"> (basic_props:predname/1)</span><span><span class="var">Pred</span> is a Name/Arity structure denoting a predicate name: <pre>predname(P/A) :-
        atm(P),
        nnegint(A).
</pre>
</span>
</ul><p><strong>Usage 2:</strong> :- <tt>export(Exports)</tt>.
<ul class="itemize_minus"><LI><em>Description:</em> Adds <span class="var">Exports</span> to the set of exported predicates.<LI><em>The following properties hold at call time:</em><br/><span class="on_right"> (basic_props:list/2)</span><span><span class="var">Exports</span> is a list of <span class="var">predname</span>s.
</span>
</ul></div></div><p>
<div><span class="on_right">DECLARATION</span><div class="defname"><a class="idx_anchor" id="use_module/2" href="ciaodeindex.html#use_module/2">use_module/2</a>:</div><div class="deftext"><p><strong>Usage:</strong> :- <tt>use_module(Module,Imports)</tt>.
<ul class="itemize_minus"><LI><em>Description:</em> Specifies that this code imports from the module defined in <span class="var">Module</span> the predicates in <span class="var">Imports</span>. The imported predicates must be exported by the other module.<LI><em>The following properties hold at call time:</em><br/><span class="on_right"> (streams_basic:sourcename/1)</span><span><span class="var">Module</span> is a source name.
</span><br/><span class="on_right"> (basic_props:list/2)</span><span><span class="var">Imports</span> is a list of <span class="var">predname</span>s.
</span>
</ul></div></div><p>
<div><span class="on_right">DECLARATION</span><div class="defname"><a class="idx_anchor" id="use_module/1" href="ciaodeindex.html#use_module/1">use_module/1</a>:</div><div class="deftext"><p><strong>Usage:</strong> :- <tt>use_module(Module)</tt>.
<ul class="itemize_minus"><LI><em>Description:</em> Specifies that this code imports from the module defined in <span class="var">Module</span> all the predicates exported by it. The previous version with the explicit import list is preferred to this as it minimizes the chances to have to recompile this code if the other module changes.<LI><em>The following properties hold at call time:</em><br/><span class="on_right"> (streams_basic:sourcename/1)</span><span><span class="var">Module</span> is a source name.
</span>
</ul></div></div><p>
<div><span class="on_right">DECLARATION</span><div class="defname"><a class="idx_anchor" id="import/2" href="ciaodeindex.html#import/2">import/2</a>:</div><div class="deftext"><p><strong>Usage:</strong> :- <tt>import(Module,Imports)</tt>.
<ul class="itemize_minus"><LI><em>Description:</em> Declares that this code imports from the module with name <span class="var">Module</span> the predicates in <span class="var">Imports</span>.<p><strong>Important note:</strong> this declaration is intended to be used when the current module or the imported module is going to be dynamically loaded, and so the compiler does not include the code of the imported module in the current executable (if only because the compiler cannot know the location of the module file at the time of compilation). For the same reason the predicates imported are not checked to be exported by <span class="var">Module</span>. Its use in other cases is strongly discouraged, as it disallows many compiler optimizations.<LI><em>The following properties hold at call time:</em><br/><span class="on_right"> (modules:modulename/1)</span><span><span class="var">Module</span> is a module name (an atom).
</span><br/><span class="on_right"> (basic_props:list/2)</span><span><span class="var">Imports</span> is a list of <span class="var">predname</span>s.
</span>
</ul></div></div><p>
<div><span class="on_right">DECLARATION</span><div class="defname"><a class="idx_anchor" id="reexport/2" href="ciaodeindex.html#reexport/2">reexport/2</a>:</div><div class="deftext"><p><strong>Usage:</strong> :- <tt>reexport(Module,Preds)</tt>.
<ul class="itemize_minus"><LI><em>Description:</em> Specifies that this code reexports from the module defined in <span class="var">Module</span> the predicates in <span class="var">Preds</span>. This implies that this module imports from the module defined in <span class="var">Module</span> the predicates in <span class="var">Preds</span>, an also that this module exports the predicates in <span class="var">Preds</span> .<LI><em>The following properties hold at call time:</em><br/><span class="on_right"> (streams_basic:sourcename/1)</span><span><span class="var">Module</span> is a source name.
</span><br/><span class="on_right"> (basic_props:list/2)</span><span><span class="var">Preds</span> is a list of <span class="var">predname</span>s.
</span>
</ul></div></div><p>
<div><span class="on_right">DECLARATION</span><div class="defname"><a class="idx_anchor" id="reexport/1" href="ciaodeindex.html#reexport/1">reexport/1</a>:</div><div class="deftext"><p><strong>Usage:</strong> :- <tt>reexport(Module)</tt>.
<ul class="itemize_minus"><LI><em>Description:</em> Specifies that this code reexports from the module defined in <span class="var">Module</span> all the predicates exported by it. This implies that this module imports from the module defined in <span class="var">Module</span> all the predicates exported by it, an also that this module exports all such predicates .<LI><em>The following properties hold at call time:</em><br/><span class="on_right"> (streams_basic:sourcename/1)</span><span><span class="var">Module</span> is a source name.
</span>
</ul></div></div><p>
<div><span class="on_right">DECLARATION</span><div class="defname"><a class="idx_anchor" id="meta_predicate/1" href="ciaodeindex.html#meta_predicate/1">meta_predicate/1</a>:</div><div class="deftext"><p><strong>Usage:</strong> :- <tt>meta_predicate MetaSpecs</tt>.
<ul class="itemize_minus"><LI><em>Description:</em> Specifies that the predicates in <span class="var">MetaSpecs</span> have arguments which has to be module expanded (predicates, goals, etc). The directive is only mandatory for exported predicates (in modules). This directive is defined as a prefix operator in the compiler.<LI><em>The following properties hold at call time:</em><br/><span class="on_right"> (basic_props:sequence/2)</span><span><span class="var">MetaSpecs</span> is a sequence of <span class="var">metaspec</span>s.
</span>
</ul></div></div><p>
<div><span class="on_right">REGTYPE</span><div class="defname"><a class="idx_anchor" id="modulename/1" href="ciaoteindex.html#modulename/1">modulename/1</a>:</div><div class="deftext">A module name is an atom, not containing characters `:&apos; or `$&apos;. Also, <tt>user</tt> and <tt>multifile</tt> are reserved, as well as the module names of all builtin modules (because in an executable all modules must have distinct names).<p><strong>Usage:</strong> <tt>modulename(M)</tt>
<ul class="itemize_minus"><LI><em>Description:</em> <span class="var">M</span> is a module name (an atom).</ul></div></div><p>
<div><span class="on_right">REGTYPE</span><div class="defname"><a class="idx_anchor" id="metaspec/1" href="ciaoteindex.html#metaspec/1">metaspec/1</a>:</div><div class="deftext">A meta-predicate specification for a predicate is the functor of that predicate applied to terms which represent the kind of module expansion that should be applied to each argument. Possible contents are represented as:<p><dl> <p><DT><tt>?,+,-,_</tt><dd> These values denote that this argument is not module expanded.<p><DT><tt>goal</tt><dd> This argument will be a term denoting a goal (either a simple or complex one) which will be called. For commpatibility reasons it can be named as <tt>:</tt> as well.<p><DT><tt>clause</tt><dd> This argument will be a term denoting a clause.<p><DT><tt>fact</tt><dd> This argument should be instantiated to a term denoting a fact (head-only clause).<p><DT><tt>spec</tt><dd> This argument should be instantiated to a predicate name, as Functor/Arity.<p><DT><tt>pred(<em>N</em>)</tt><dd> This argument should be instantiated to a predicate construct to be called by means of a <tt>call/<em>N</em></tt> predicate call (see <a class="idx_anchor" id="12" href="ciaoglindex.html#call/2"><tt>call/2</tt></a>).<p><DT><tt>list(<em>Meta</em>)</tt><dd> This argument should be instantiated to a list of terms as described by <em>Meta</em> (e.g. <tt>list(goal)</tt>).<p><DT><tt>addterm(Meta)</tt><dd> This argument should be instantiated to the meta-data specified by <em>Meta</em>, and an argument added after this one will carry the original data without module expansion. Not intended to be used by normal users.<p><DT><tt>addmodule(Meta)</tt><dd> This argument should be instantiated to the meta-data specified by <em>Meta</em>, and in an argument added after this one will be passed the calling module, for example to allow handling more involved meta-data by using conversion builtins. <tt>addmodule</tt> is an alias of <tt>addmodule(?)</tt>. Not intended to be used by normal users.<p></dl><p><strong>Usage:</strong> <tt>metaspec(M)</tt>
<ul class="itemize_minus"><LI><em>Description:</em> <span class="var">M</span> is a meta-predicate specification.</ul></div></div><p>
</div></div></div></div></div><div class="sidebarwrapper"><div class="sidebar"><IMG SRC="autofigciao-shadow-64h.png"><h2>Module Sections</h2><ul><LI><a href="#Usage and interface">Usage and interface</a><LI><a href="#Documentation on internals">Documentation on internals</a></ul><h2>Global Links</h2><ul><LI><a href="ciaofulltoc.html">Table of Contents</a><LI><a href="ciaochanges.html">Version/Change Log</a><LI><a href="ciaorefs.html">References</a><LI><a href="ciaocopyright.html">Copyright</a></ul><h2>Indices</h2><ul><LI><a href="ciaoliindex.html">Library/Module Index</a><LI><a href="ciaopdindex.html">Predicate/Method Index</a><LI><a href="ciaoprindex.html">Property Index</a><LI><a href="ciaoteindex.html">Regular Type Index</a><LI><a href="ciaodeindex.html">Declaration Index</a><LI><a href="ciaocoindex.html">Concept Index</a><LI><a href="ciaoauindex.html">Author Index</a><LI><a href="ciaoglindex.html">Global Index</a></ul></div></div><div class="clearer"></div></div><div class="nav"><span class="on_right"><a class="navbutton" href="Builtins.html">&#x25C4;</a><a class="navbutton" href="loading_code.html">&#x25BA;</a></span><span>&nbsp;</span></div><div class="footer">Generated with LPdoc using Ciao</div></body></html>