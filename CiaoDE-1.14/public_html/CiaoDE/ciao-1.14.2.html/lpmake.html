<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd"><html><head><meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1"/><link rel="stylesheet" href="lpdoc.css" type="text/css"/><title>The Ciao lpmake scripting facility &mdash; The Ciao System v1.14#2</title></head><body><div class="nav"><span class="on_right"><a class="navbutton" href="pldiff.html">&#x25C4;</a><a class="navbutton" href="ciao_get_arch_doc.html">&#x25BA;</a></span><span><a href="ciao.html">The Ciao System</a> &raquo; <a href="ciao-utilities.html">PART X - Miscellaneous standalone utilities</a> &raquo; </span></div><div class="documentwrapper"><div class="document"><div class="mainwrapper"><div class="main"><div id=""><h1>The Ciao lpmake scripting facility</h1>
<strong>Author(s):</strong> <a class="idx_anchor" id="Manuel Hermenegildo" href="ciaoauindex.html#Manuel Hermenegildo">Manuel Hermenegildo</a>, <a class="idx_anchor" id="The CLIP Group" href="ciaoauindex.html#The CLIP Group">The CLIP Group</a>.<p>
<p><a class="idx_anchor" id="0" href="ciaocoindex.html#make"></a> <a class="idx_anchor" id="1" href="ciaocoindex.html#lpmake"></a> <p><strong>Note</strong>: <a class="idx_anchor" id="2" href="ciaoglindex.html#lpmake"><tt>lpmake</tt></a> and the <a class="idx_anchor" id="3" href="ciaoglindex.html#make"><tt>make</tt></a> library are still under development, and they may change in future releases.<p><a class="idx_anchor" id="4" href="ciaoglindex.html#lpmake"><tt>lpmake</tt></a> is a Ciao application which uses the Ciao <a class="idx_anchor" id="5" href="ciaoglindex.html#make"><tt>make</tt></a> library to implement a dependency-driven scripts in a similar way to the Un*x <a class="idx_anchor" id="6" href="ciaoglindex.html#make"><tt>make</tt></a> facility.<p>The original purpose of the Un*x <a class="idx_anchor" id="7" href="ciaoglindex.html#make"><tt>make</tt></a> utility is to determine automatically which pieces of a large program needed to be recompiled, and issue the commands to recompile them. In practice, <a class="idx_anchor" id="8" href="ciaoglindex.html#make"><tt>make</tt></a> is often used for many other purposes: it can be used to describe any task where some files must be updated automatically from others whenever these change. <a class="idx_anchor" id="9" href="ciaoglindex.html#lpmake"><tt>lpmake</tt></a> can be used for the same types of applications as <a class="idx_anchor" id="10" href="ciaoglindex.html#make"><tt>make</tt></a>, and also for some new ones, and, while being simpler, it offers a number of advantages over <a class="idx_anchor" id="11" href="ciaoglindex.html#make"><tt>make</tt></a>. The first one is <em>portability</em>. When compiled to a bytecode executable <a class="idx_anchor" id="12" href="ciaoglindex.html#lpmake"><tt>lpmake</tt></a> runs on any platform where a Ciao engine is available. Also, the fact that typically many of the operations are programmed in Prolog within the makefile, not needing external applications, improves portability further. The second advantage of <a class="idx_anchor" id="13" href="ciaoglindex.html#lpmake"><tt>lpmake</tt></a> is <em>improved programming capabilities</em>. While <a class="idx_anchor" id="14" href="ciaoglindex.html#lpmake"><tt>lpmake</tt></a> is simpler than <a class="idx_anchor" id="15" href="ciaoglindex.html#make"><tt>make</tt></a>, <a class="idx_anchor" id="16" href="ciaoglindex.html#lpmake"><tt>lpmake</tt></a> allows using the Ciao Prolog language within the scripts. This allows establising more complex dependencies and programming powerful operations within the make file, and without resorting to external packages (e.g., operating system commands), which also helps portability. A final advantage of <a class="idx_anchor" id="17" href="ciaoglindex.html#lpmake"><tt>lpmake</tt></a> is that it supports a form of <em>autodocumentation</em>: <a class="idx_anchor" id="18" href="ciaocoindex.html#lpmake autodocumentation"></a> comments associated to targets can be included in the configuration files. Calling <a class="idx_anchor" id="19" href="ciaoglindex.html#lpmake"><tt>lpmake</tt></a> in a directory which has such a configuration file explains what commands the configuration file support and what these commands will do.<p><div id="General operation"><h2>General operation</h2> <p>To prepare to use <a class="idx_anchor" id="20" href="ciaoglindex.html#lpmake"><tt>lpmake</tt></a>, and in a similar way to <a class="idx_anchor" id="21" href="ciaoglindex.html#make"><tt>make</tt></a>, you must write a <a class="idx_anchor" id="22" href="ciaocoindex.html#configuration file"><em>configuration file</em></a>: a module (typically called <a class="idx_anchor" id="23" href="ciaoglindex.html#Makefile.pl"><tt>Makefile.pl</tt></a>) that describes the relationships among files in your program or application, and states the commands for updating each file. In the case of compiling a program, typically the executable file is obtained from object files, which are in turn obtained by compiling source files. Another example is running <a class="idx_anchor" id="24" href="ciaoglindex.html#latex"><tt>latex</tt></a> and <a class="idx_anchor" id="25" href="ciaoglindex.html#dvips"><tt>dvips</tt></a> on a set of source <tt>.tex</tt> files to generate a document in <tt>dvi</tt> and <tt>postscript</tt> formats.<p>Once a suitable make file exists, each time you change some source files, simply typing <tt>lpmake</tt> suffices to perform all necessary operations (recompilations, processing text files, etc.). The <a class="idx_anchor" id="26" href="ciaoglindex.html#lpmake"><tt>lpmake</tt></a> program uses the dependency rules in the makefile and the last modification times of the files to decide which of the files need to be updated. For each of those files, it issues the commands recorded in the makefile. For example, in the <a class="idx_anchor" id="27" href="ciaoglindex.html#latex"><tt>latex</tt></a>/<a class="idx_anchor" id="28" href="ciaoglindex.html#dvips"><tt>dvips</tt></a> case one rule states that the <tt>.dvi</tt> file whould be updated from the <tt>.tex</tt> files whenever one of them changes and another rule states that the <tt>.ps</tt> file needs to be updated from a <tt>.dvi</tt> file every time it changes. The rules also describe the commands to be issued to update the files.<p>So, the general process is as follows: <a class="idx_anchor" id="29" href="ciaoglindex.html#lpmake"><tt>lpmake</tt></a> executes commands in the configuration file to update one or more target <em>names</em>, where <em>name</em> is often a program, but can also be a file to be generated or even a &ldquo;virtual&rdquo; target. <a class="idx_anchor" id="30" href="ciaoglindex.html#lpmake"><tt>lpmake</tt></a> updates a target if it depends on prerequisite files that have been modified since the target was last modified, or if the target does not exist. You can provide command line arguments to <a class="idx_anchor" id="31" href="ciaoglindex.html#lpmake"><tt>lpmake</tt></a> to control which files should be regenerated, or how.<p></div><div id="Format of the Configuration File"><h2>Format of the Configuration File</h2> <p><a class="idx_anchor" id="32" href="ciaoglindex.html#lpmake"><tt>lpmake</tt></a> uses as default configuration file the file <a class="idx_anchor" id="33" href="ciaoglindex.html#Makefile.pl"><tt>Makefile.pl</tt></a>, if it is present in the current directory. This can be overridden and another file used by means of the <tt>-m</tt> option. The configuration file must be a <em>module</em> and this module must make use of the <a class="idx_anchor" id="34" href="ciaoglindex.html#make"><tt>make</tt></a> package. This package provides syntax for defining the dependency rules and functionality for correctly interpreting these rules.<p>The configuration file can contain such rules and also arbitrary Ciao Prolog predicates, and can also import other Ciao modules, packages, or make file. This is useful to implement inherintance across diferent configuration files, i.e., the values declared in a configuration file can be easily made to override those defined in another, using the standard Ciao rules for module overriding, reexport, etc. The syntax of the rules is described in <a href="make_doc.html">The Ciao Make Package</a>, together with some examples.<p></div><div id="lpmake usage"><h2>lpmake usage</h2> <p><pre>

Supported command line options:

lpmake [-v] [-d Name1=Value1] ... [-d Namen=Valuen] \
	&lt;command1&gt; ... &lt;commandn&gt;

  Process commands &lt;command1&gt; ... &lt;commandn&gt;, using file &apos;Makefile.pl&apos;
  or directory &apos;installer&apos; in the current directory as configuration
  file. The configuration file must be a module.

  The optional argument &apos;-v&apos; produces verbose output, reporting on the
  processing of the dependency rules.  Very useful for debugging
  makefiles.

  The argument &apos;-d&apos; indicates that a variable definition Name=Value
  follows.  The effect of this is adding the fact &apos;name_value(Name, Value).&apos;
  (i.e., &apos;name_value(Name) := Value.&apos;), defined in the module 
  library(make(make_rt)).

lpmake [-v] [-d Name1=Value1] ... [-d Namen=Valuen] \
	[[-m|-l] &lt;.../Configfile1.pl&gt;] [[-m|-l] &lt;.../Configfilen.pl&gt;] \
        &lt;command1&gt; ... &lt;commandn&gt;

  Same as above, but using files &lt;.../Configfilex.pl&gt; as configuration
  file. One or more configuration files can be used. When using more
  than one configuration file, the additional configuration files are
  loaded dynamically into the first one with the predicate
  register_config_file/1.  Using -l instead of -m indicates that this
  configuration file is a library module (i.e., it will be looked for
  in the libraries).

lpmake -h     [ [-m|-l] &lt;.../Configfile.pl&gt; ]
lpmake -help  [ [-m|-l] &lt;.../Configfile.pl&gt; ]
lpmake --help [ [-m|-l] &lt;.../Configfile.pl&gt; ]

  Print this help message. If a configuration file is available in the
  current directory or is given as an option, and the commands in it
  are commented, then information on these commands is also printed.


</pre> <p></div><br/><div id="Acknowledgments"><h2>Acknowledgments</h2>
Some parts of the documentation are taken from the documentation of GNU&apos;s <a class="idx_anchor" id="35" href="ciaoglindex.html#gmake"><tt>gmake</tt></a>.<br/></div><div id="Known bugs and planned improvements"><h2>Known bugs and planned improvements</h2><ul><LI>Rename or add a default directory makedir/Makedir, instead of installer directory, as recommended by Manuel Herme. -- EMM</ul></div></div></div></div></div><div class="sidebarwrapper"><div class="sidebar"><IMG SRC="autofigciao-shadow-64h.png"><h2>Global Links</h2><ul><LI><a href="ciaofulltoc.html">Table of Contents</a><LI><a href="ciaochanges.html">Version/Change Log</a><LI><a href="ciaorefs.html">References</a><LI><a href="ciaocopyright.html">Copyright</a></ul><h2>Indices</h2><ul><LI><a href="ciaoliindex.html">Library/Module Index</a><LI><a href="ciaopdindex.html">Predicate/Method Index</a><LI><a href="ciaoprindex.html">Property Index</a><LI><a href="ciaoteindex.html">Regular Type Index</a><LI><a href="ciaodeindex.html">Declaration Index</a><LI><a href="ciaocoindex.html">Concept Index</a><LI><a href="ciaoauindex.html">Author Index</a><LI><a href="ciaoglindex.html">Global Index</a></ul></div></div><div class="clearer"></div></div><div class="nav"><span class="on_right"><a class="navbutton" href="pldiff.html">&#x25C4;</a><a class="navbutton" href="ciao_get_arch_doc.html">&#x25BA;</a></span><span>&nbsp;</span></div><div class="footer">Generated with LPdoc using Ciao</div></body></html>