<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd"><html><head><meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1"/><link rel="stylesheet" href="lpdoc.css" type="text/css"/><title>The script interpreter &mdash; The Ciao System v1.14#2</title></head><body><div class="nav"><span class="on_right"><a class="navbutton" href="debugger.html">&#x25C4;</a><a class="navbutton" href="libpaths.html">&#x25BA;</a></span><span><a href="ciao.html">The Ciao System</a> &raquo; <a href="DevEnv.html">PART I - The program development environment</a> &raquo; </span></div><div class="documentwrapper"><div class="document"><div class="mainwrapper"><div class="main"><div id=""><h1>The script interpreter</h1>
<strong>Author(s):</strong> <a class="idx_anchor" id="Daniel Cabeza" href="ciaoauindex.html#Daniel Cabeza">Daniel Cabeza</a>, <a class="idx_anchor" id="Manuel Hermenegildo" href="ciaoauindex.html#Manuel Hermenegildo">Manuel Hermenegildo</a>.<p>
<a class="idx_anchor" id="0" href="ciaoglindex.html#ciao-shell"><tt>ciao-shell</tt></a> is the Ciao script interpreter. It can be used to write <a class="idx_anchor" id="1" href="ciaocoindex.html#Prolog shell scripts"><em>Prolog shell scripts</em></a> (see [<a href="ciaorefs.html#sicstus-scripts-complangprolog-www">Her96</a>,<a href="ciaorefs.html#pillow-ws">CHV96b</a>]), that is, executable files containing source code, which are compiled on demand.<p>Writing Prolog scripts can sometimes be advantageous with respect to creating binary executables for small- to medium-sized programs that are modified often and perform relatively simple tasks. The advantage is that no explicit compilation is necessary, and thus changes and updates to the program imply only editing the source file. The disadvantage is that startup of the script (the first time after it is modified) is slower than for an application that has been compiled previously.<p>An area of application is, for example, writing <a class="idx_anchor" id="2" href="ciaocoindex.html#CGI executables"><em>CGI executables</em></a>: the slow speed of the network connection in comparison with that of executing a program makes program execution speed less important and has made scripting languages very popular for writing these applications. Logic languages are, a priori, excellent candidates to be used as scripting languages. For example, the built-in grammars and databases can sometimes greatly simplify many typical script-based applications.<p><div id="How it works"><h2>How it works</h2> <p>Essentially, <tt>ciao-shell</tt> is a smaller version of the Ciao top-level, which starts by loading the file given to it as the first argument and then starts execution at <a class="idx_anchor" id="3" href="ciaoglindex.html#main/1"><tt>main/1</tt></a> (the argument is instantiated to a list containing the command line options, in the usual way). Note that the Prolog script cannot have a <tt>module</tt> declaration for this to work. While loading the file, <tt>ciao-shell</tt> changes the <a class="idx_anchor" id="4" href="ciaoglindex.html#prolog flag">prolog flag</a> <tt>quiet</tt> so that no informational or warning messages are printed (error messages will be reported to <tt>user_error</tt>, however). The operation of <tt>ciao-shell</tt> in Unix-like systems is based in a special compiler feature: when the first character of a file is &apos;<tt>#</tt>&apos;, the compiler skips the first lines until an empty line is found. In Windows, its use is as easy as naming the file with a <tt>.pls</tt> extension, which will launch <tt>ciao-shell</tt> appropriately.<p>For example, in a Linux/Unix system, assume a file called <a class="idx_anchor" id="5" href="ciaoglindex.html#hello"><tt>hello</tt></a> contains the following program:<p><pre>#!/bin/sh 
exec ciao-shell $0 &quot;$@&quot; # -*- mode: ciao; -*-

main(_) :-
     write(&apos;Hello world&apos;), nl.
</pre> <p>Then, the file <a class="idx_anchor" id="6" href="ciaoglindex.html#hello"><tt>hello</tt></a> can be <em>run</em> by simply making it executable and invoking it from the command line:<p><pre>/herme@clip:/tmp
[86]&gt; chmod +x hello

/herme@clip:/tmp
[87]&gt; hello
Hello world
</pre> <p>The line: <pre>#!/bin/sh 
</pre> invokes the <tt>/bin/sh</tt> shell which will interpret the following line: <pre>exec ciao-shell $0 &quot;$@&quot; # -*- mode: ciao; -*-
</pre> <p>and invoke <a class="idx_anchor" id="7" href="ciaoglindex.html#ciao-shell"><tt>ciao-shell</tt></a>, instructing it to read this same file (<tt>$0</tt>), passing it the rest of the arguments to <tt>hello</tt> as arguments to the prolog program. The second part of the line <tt># -*- mode: ciao; -*-</tt> is simply a comment which is seen by <a class="idx_anchor" id="8" href="ciaoglindex.html#emacs"><tt>emacs</tt></a> and instructs it to edit this file in Ciao mode (this is needed because these script files typically do not have a <tt>.pl</tt> ending). When <a class="idx_anchor" id="9" href="ciaoglindex.html#ciao-shell"><tt>ciao-shell</tt></a> starts, if it is the first time, it compiles the program (skipping the first lines, as explained above), or else at successive runs loads the <tt>.po</tt> object file, and then calls <a class="idx_anchor" id="10" href="ciaoglindex.html#main/1"><tt>main/1</tt></a>.<p>Note that the process of creating Prolog scripts is made very simple by the Ciao <a class="idx_anchor" id="11" href="ciaoglindex.html#emacs mode">emacs mode</a>, which automatically inserts the header and makes the file executable (See <a href="CiaoMode.html">Using Ciao inside GNU emacs</a>).<p></div><div id="Command line arguments in scripts"><h2>Command line arguments in scripts</h2> <p>The following example illustrates the use of command-line arguments in scripts. Assume that a file called <tt>say</tt> contains the following lines:<p><pre>#!/bin/sh 
exec ciao-shell $0 &quot;$@&quot; # -*- mode: ciao; -*-

main(Argv) :-
     write_list(Argv), nl.

write_list([]).
write_list([Arg|Args]) :- 
     write(Arg),
     write(&apos; &apos;),
     write_list(Args).
</pre> <p>An example of use is:<p><pre>/herme@clip:/tmp
[91]&gt; say hello dolly
hello dolly 
</pre> <p><p></div><br/></div></div></div></div><div class="sidebarwrapper"><div class="sidebar"><IMG SRC="autofigciao-shadow-64h.png"><h2>Global Links</h2><ul><LI><a href="ciaofulltoc.html">Table of Contents</a><LI><a href="ciaochanges.html">Version/Change Log</a><LI><a href="ciaorefs.html">References</a><LI><a href="ciaocopyright.html">Copyright</a></ul><h2>Indices</h2><ul><LI><a href="ciaoliindex.html">Library/Module Index</a><LI><a href="ciaopdindex.html">Predicate/Method Index</a><LI><a href="ciaoprindex.html">Property Index</a><LI><a href="ciaoteindex.html">Regular Type Index</a><LI><a href="ciaodeindex.html">Declaration Index</a><LI><a href="ciaocoindex.html">Concept Index</a><LI><a href="ciaoauindex.html">Author Index</a><LI><a href="ciaoglindex.html">Global Index</a></ul></div></div><div class="clearer"></div></div><div class="nav"><span class="on_right"><a class="navbutton" href="debugger.html">&#x25C4;</a><a class="navbutton" href="libpaths.html">&#x25BA;</a></span><span>&nbsp;</span></div><div class="footer">Generated with LPdoc using Ciao</div></body></html>