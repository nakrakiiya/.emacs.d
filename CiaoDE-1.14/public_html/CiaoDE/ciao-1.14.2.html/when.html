<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01//EN" "http://www.w3.org/TR/html4/strict.dtd"><html><head><meta http-equiv="Content-Type" content="text/html; charset=iso-8859-1"/><link rel="stylesheet" href="lpdoc.css" type="text/css"/><title>Delaying predicates (when) &mdash; The Ciao System v1.14#2</title></head><body><div class="nav"><span class="on_right"><a class="navbutton" href="freeze.html">&#x25C4;</a><a class="navbutton" href="actmods_doc.html">&#x25BA;</a></span><span><a href="ciao.html">The Ciao System</a> &raquo; <a href="ExtendProlog.html">PART VII - Ciao extensions</a> &raquo; </span></div><div class="documentwrapper"><div class="document"><div class="mainwrapper"><div class="main"><div id=""><h1>Delaying predicates (when)</h1><a class="idx_anchor" href="ciaoliindex.html#when"></a>
<strong>Author(s):</strong> <a class="idx_anchor" id="Manuel Carro" href="ciaoauindex.html#Manuel Carro">Manuel Carro</a>.<p>
<p><a class="idx_anchor" id="0" href="ciaoglindex.html#when/2"><tt>when/2</tt></a> delays a predicate until some condition in its variable is met. For example, we may want to find out the maximum of two numbers, but we are not sure when they will be instantiated. We can write the standard <a class="idx_anchor" id="1" href="ciaoglindex.html#max/3"><tt>max/3</tt></a> predicate (but changing its name to <a class="idx_anchor" id="2" href="ciaoglindex.html#gmax/3"><tt>gmax/3</tt></a> to denote that the first and second arguments must be ground) as<p><pre>gmax(X, Y, X):- X &gt; Y, !.
gmax(X, Y, Y):- X =&lt; Y.
</pre> <p>and then define a &apos;safe&apos; <a class="idx_anchor" id="3" href="ciaoglindex.html#max/3"><tt>max/3</tt></a> as<p> <pre>max(X, Y, Z):-
        when((ground(X),ground(Y)), gmax(X, Y, Z)).
</pre> <p>which can be called as follows:<p><pre>?- max(X, Y, Z) , Y = 0, X = 8.

X = 8,
Y = 0,
Z = 8 ? 

yes
</pre> <p>Alternatively, <a class="idx_anchor" id="4" href="ciaoglindex.html#max/3"><tt>max/3</tt></a> could have been defined as<p><pre>max(X, Y, Z):-
        when(ground((X, Y)), gmax(X, Y, Z)).
</pre> <p>with the same effects as above. More complex implementations are possible. Look, for example, at the <tt>max.pl</tt> implementation under the <tt>when</tt> library directory, where a <a class="idx_anchor" id="5" href="ciaoglindex.html#max/3"><tt>max/3</tt></a> predicate is implemented which waits on all the arguments until there is enough information to determine their values:<p><pre>?- use_module(library(when(max))).

yes
?- max(X, Y, Z), Z = 5, Y = 4.

X = 5,
Y = 4,
Z = 5 ? 

yes
</pre> <p><br/><div id="Usage and interface"><h2>Usage and interface</h2><div class="cartouche"><ul><LI><strong>Library usage:</strong><br/><tt>:- use_module(library(when)).</tt><LI><strong>Exports:</strong><br/><ul class="itemize_minus"><LI><em>Predicates:</em><br/><a class="idx_anchor" id="6" href="ciaoglindex.html#when/2"><tt>when/2</tt></a>.
<LI><em>Regular Types:</em><br/><a class="idx_anchor" id="7" href="ciaoglindex.html#wakeup_exp/1"><tt>wakeup_exp/1</tt></a>.
</ul><LI><strong>Other modules used:</strong><br/><ul class="itemize_minus"><LI><em>System library modules:</em><br/><a class="idx_anchor" id="8" href="ciaoglindex.html#terms_vars"><tt>terms_vars</tt></a>, <a class="idx_anchor" id="9" href="ciaoglindex.html#sort"><tt>sort</tt></a>, <a class="idx_anchor" id="10" href="ciaoglindex.html#sets"><tt>sets</tt></a>.
</ul></ul></div></div><div id="Documentation on exports"><h2>Documentation on exports</h2><div><span class="on_right">PREDICATE</span><div class="defname"><a class="idx_anchor" id="when/2" href="ciaopdindex.html#when/2">when/2</a>:</div><div class="deftext"><br/>
<em>Meta-predicate</em> with arguments: <tt>when(?,goal)</tt>.<br/><p><strong>Usage:</strong> <tt>when(WakeupCond,Goal)</tt>
<ul class="itemize_minus"><LI><em>Description:</em> Delays / executes <span class="var">Goal</span> according to <span class="var">WakeupCond</span> given. The <span class="var">WakeupCond</span>s now acceptable are <tt>ground(T)</tt> (<a class="idx_anchor" id="11" href="ciaoglindex.html#Goal"><tt>Goal</tt></a> is delayed until <tt>T</tt> is ground), <tt>nonvar(T)</tt> (<a class="idx_anchor" id="12" href="ciaoglindex.html#Goal"><tt>Goal</tt></a> is delayed until <tt>T</tt> is not a variable), and conjunctions and disjunctions of conditions:<p><pre>wakeup_exp(ground(_1)).
wakeup_exp(nonvar(_1)).
wakeup_exp((C1,C2)) :-
        wakeup_exp(C1),
        wakeup_exp(C2).
wakeup_exp((C1;C2)) :-
        wakeup_exp(C1),
        wakeup_exp(C2).
</pre> <p><a class="idx_anchor" id="13" href="ciaoglindex.html#when/2"><tt>when/2</tt></a> only fails it the <span class="var">WakeupCond</span> is not legally formed. If <span class="var">WakeupCond</span> is met at the time of the call no delay mechanism is involved --- but there exists a time penalty in the condition checking.<p>In case that an instantiation fires the execution of several predicates, the order in which these are executed is not defined.<LI><em>The following properties should hold at call time:</em><br/><span class="on_right"> (when:wakeup_exp/1)</span><span><span class="var">WakeupCond</span> is a legal expression for delaying goals.
</span><br/><span class="on_right"> (basic_props:callable/1)</span><span><span class="var">Goal</span> is a term which represents a goal, i.e., an atom or a structure.
</span>
</ul></div></div><p>
<div><span class="on_right">REGTYPE</span><div class="defname"><a class="idx_anchor" id="wakeup_exp/1" href="ciaoteindex.html#wakeup_exp/1">wakeup_exp/1</a>:</div><div class="deftext"><p><strong>Usage:</strong> <tt>wakeup_exp(T)</tt>
<ul class="itemize_minus"><LI><em>Description:</em> <span class="var">T</span> is a legal expression for delaying goals.</ul></div></div><p>
</div><div id="Known bugs and planned improvements"><h2>Known bugs and planned improvements</h2><ul><LI>Redundant conditions are not removed.<LI>Floundered goals are not appropriately printed.</ul></div></div></div></div></div><div class="sidebarwrapper"><div class="sidebar"><IMG SRC="autofigciao-shadow-64h.png"><h2>Module Sections</h2><ul><LI><a href="#Usage and interface">Usage and interface</a><LI><a href="#Documentation on exports">Documentation on exports</a><LI><a href="#Known bugs and planned improvements">Known bugs and planned improvements</a></ul><h2>Global Links</h2><ul><LI><a href="ciaofulltoc.html">Table of Contents</a><LI><a href="ciaochanges.html">Version/Change Log</a><LI><a href="ciaorefs.html">References</a><LI><a href="ciaocopyright.html">Copyright</a></ul><h2>Indices</h2><ul><LI><a href="ciaoliindex.html">Library/Module Index</a><LI><a href="ciaopdindex.html">Predicate/Method Index</a><LI><a href="ciaoprindex.html">Property Index</a><LI><a href="ciaoteindex.html">Regular Type Index</a><LI><a href="ciaodeindex.html">Declaration Index</a><LI><a href="ciaocoindex.html">Concept Index</a><LI><a href="ciaoauindex.html">Author Index</a><LI><a href="ciaoglindex.html">Global Index</a></ul></div></div><div class="clearer"></div></div><div class="nav"><span class="on_right"><a class="navbutton" href="freeze.html">&#x25C4;</a><a class="navbutton" href="actmods_doc.html">&#x25BA;</a></span><span>&nbsp;</span></div><div class="footer">Generated with LPdoc using Ciao</div></body></html>